import Synopsis from "@site/src/components/Synopsis";

import Table from '@site/src/components/Table';
import TableBody from '@site/src/components/Table/TableBody';
import TableRow from '@site/src/components/Table/TableRow';
import TableCell from '@site/src/components/Table/TableCell';

# Dot Expander

<Synopsis>
Expands a field containing dots into an object field. Makes fields with dots in their names accessible to other processors.
</Synopsis>

## Parameters

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|Y|N/A|The field to be expanded. If set to `*`, all top-level fields will be expanded|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|See [Handling Failures](../handling-failures.mdx)|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`path`|N|-|The field containing the field to expand. Only required when `field` is part of another object field since only leaf level fields can be processed|
|`tag`|N|-|Identifier|

## Examples

* If the expanded name is distinct, the part after the dot becomes nested:

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A.B": "v"
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "dot_expander": {
                  "field": "A.B"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B": "v"
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>

* If the dotted field clashes with a nested one, it is merged with it:

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A.B": "v1",
               "A": {
                  "B": "v2"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "dot_expander": {
                  "field": "A.B"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B": ["v1", "v2"]
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>

* Using `override` causes the expanded field to be overridden by the nested one

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A.B": "v1",
               "A": {
                  "B": "v2"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "dot_expander": {
                  "field": "A.B",
                  "override": true
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B": "v2"
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>

* Using `*` expands all top-level fields

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A.B": "v1",
               "C.D": "v2"
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "dot_expander": {
                  "field": "*"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B": "v1"
               },
               "C": {
                  "D": "v2"
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>

* If the dotted field is nested within a field, use `path` to navigate down

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B.C": "v1",
                  "B.D": "v2"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "dot_expander": {
                  "path": "A",
                  "field": "*"
               }
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": {
                  "B": {
                     "C": "v1",
                     "D": "v2"
                  }
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>

* If there is a potential for a clash between an expanded field and another one at the same level, use `rename` first

<Table>
   <TableBody>
      <TableRow>
         <TableCell>
            **Input**
         </TableCell>
         <TableCell>
            ```js
            {
               "A": "v1",
               "A.B": "v2"
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Spec**
         </TableCell>
         <TableCell>
            ```js
            {
               "processors": [
                  {
                     "rename": {
                        "field": "A",
                        "target_field": "A.B"
                     }
                  },
                  {
                     "dot_expander": {
                        "path": "A",
                        "field": "*"
                     }
                  }
               ]
            }
            ```
         </TableCell>
      </TableRow>
      <TableRow>
         <TableCell>
            **Output**
         </TableCell>
         <TableCell>
            ```code
            {
               "A": {
                  "B": ["v1", "v2"]
               }
            }
            ```
         </TableCell>
      </TableRow>
   </TableBody>
</Table>
