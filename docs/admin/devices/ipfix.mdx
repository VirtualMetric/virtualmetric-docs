# IPFix

## Synopsis

```yaml
- id: <numeric>
  name: <string>
  description: <string>
  type: ipfix
  tags: <string[]>
  pipelines: <pipeline[]>
  status: <boolean>
  properties:
    address: <string>
    port: <numeric>
    reuse: <boolean>
    buffer_size: <numeric>
    stats_frequency: <numeric>
```

## Description

Creates an IPFix collector that accepts flow data over UDP connections. Supports high-performance collection with multiple worker processes and configurable buffer sizes.

## Basic Configuration

The following are the minimum requirements to define the device.

### Device Properties

|Field|Required|Default|Description|
|---|---|---|---|
|`id`|Y||Unique identifier|
|`name`|Y||Device name|
|`description`|N|-|Optional description|
|`type`|Y||Must be `ipfix`|
|`tags`|N|-|Optional tags|
|`pipelines`|N|-|Optional pre-processor pipelines|
|`status`|N|`true`|Enable/disable the device|

### Network Properties

|Field|Required|Default|Description|
|---|---|---|---|
|`address`|N|`"0.0.0.0"`|Listen address|
|`port`|N|`4739`|Listen port|
|`reuse`|N|`true`|Enable socket address reuse|

### Performance Properties

|Field|Required|Default|Description|
|---|---|---|---|
|`buffer_size`|N|`9000`|Network read buffer size in bytes|
|`stats_frequency`|N|`300`|Statistics collection interval in seconds|

## Advanced Features

### Multi-Worker Processing

When `reuse` is enabled, the collector automatically scales to use multiple worker processes based on available CPU cores. Each worker:
- Maintains its own UDP listener
- Processes flows independently
- Writes to a dedicated queue file

### Flow Processing

The collector supports:
- Template management for NetFlow v9/IPFix
- Application identification
- Port-based protocol mapping
- Flow state tracking
- Statistics aggregation

## Examples

### Basic Configuration

The minimum required configuration using defaults:

<ExampleGrid>
  <CommentCol>
    Create a simple IPFix collector...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 1
      name: basic_ipfix
      type: ipfix
      properties:
        port: 4739
    ```
  </CodeCol>
</ExampleGrid>

### High-Performance Configuration

For enhanced performance with high flow volumes:

<ExampleGrid>
  <CommentCol>
    Optimized for high message volumes...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 2
      name: performance_ipfix
      type: ipfix
      properties:
        address: "0.0.0.0"
        port: 4739
        reuse: true
        buffer_size: 32768
    ```
  </CodeCol>
</ExampleGrid>

:::note
When `reuse` is enabled, the collector automatically scales to use all available CPU cores for processing.
:::

### Multiple Flow Types

For collecting different flow types on a single device:

<ExampleGrid>
  <CommentCol>
    Collect multiple flow types...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 3
      name: multi_flow
      type: ipfix
      properties:
        address: "0.0.0.0"
        port: 4739
        reuse: true
        buffer_size: 16384
        stats_frequency: 60
    ```
  </CodeCol>
</ExampleGrid>

:::warning
Each flow type requires its own port. Ensure no port conflicts exist between different collectors.
:::

### Application Protocol Identification

The collector supports application protocol identification through multiple methods:

1. Application-based identification using app-definitions.csv
2. TCP port mapping using tcp-definitions.csv
3. UDP port mapping using udp-definitions.csv

The definition files can be placed in three locations, checked in the following order:
1. `/definitions/app-definitions-{device-id}.csv` (device-specific)
2. `/definitions/app-definitions.csv` (user-defined)
3. `/package/definitions/app-definitions.csv` (system defaults)

<ExampleGrid>
  <CommentCol>
    Basic flow collection with application identification...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 4
      name: app_aware_ipfix
      type: ipfix
      properties:
        port: 4739
        reuse: true
        buffer_size: 16384
    ```
  </CodeCol>
</ExampleGrid>

Definition files use CSV format:

app-definitions.csv:
```csv
SSH,Secure Shell
RDP,Remote Desktop
HTTP,Web Browsing
HTTPS,Secure Web
```

tcp-definitions.csv:
```csv
22,SSH
3389,RDP
80,HTTP
443,HTTPS
```

udp-definitions.csv:
```csv
53,DNS
67,DHCP
123,NTP
161,SNMP
```

:::note
The collector will fall back to system defaults if custom definition files are not found.
:::

:::warning
Definition files must be in CSV format with exactly two columns per row.
:::