# Dot Expander

## Synopsis

```yaml {2}
dot_expander:
   - field: <ident>
   - description: <string>
   - if: <script>
   - ignore_failure: <logical>
   - on_failure: <processors...>
   - on_success: <processors...>
   - path: <string>
   - tag: <string>
```

## Description

**Functionality**: Expands a field containing dots into an object field. Makes fields with dots in their names accessible to other processors.

## Parameters

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|Y|N/foo|Field to be expanded. If set to `*`, all top-level fields will be expanded|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|See [Handling Failures](../handling-failures.mdx)|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`path`|N|-|Field containing the field to expand. Only required when `field` is part of another object field since only leaf level fields can be processed|
|`tag`|N|-|Identifier|

{/* FIXME: Append the input json field to the output json */}

## Examples

<ExampleTable>
   <Description>
      If the expanded name is distinct...
   </Description>
   <SampleCode>
      ```json
      {
         "foo.bar": "A"
      }
      ```
   </SampleCode>
   <Description>
      the part after the dot becomes nested:
   </Description>
   <SampleCode>
      ```yaml
      dot_expander:
         - field: foo.bar
      ```
      ```json
      {
         "foo": {
            "bar": "A"
         }
      }
      ```
   </SampleCode>

   <Description>
      If the dotted field clashes with a nested field...
   </Description>
   <SampleCode>
   ```json
   {
      "foo.bar": "A",
      "foo": {
         "bar": "B"
      }
   }
   ```
   </SampleCode>
   <Description>
      it is merged with it:
   </Description>
   <SampleCode>
      ```yaml
      dot_expander:
         field: foo.bar
      ```
      ```json
      {
         "foo": {
            "bar": ["A", "B"]
         }
      }
      ```
   </SampleCode>

   <Description>
      Using `override` causes the expanded field to be overridden by the nested field:
   </Description>
   <SampleCode>
      ```yaml
      dot_expander:
         - field: foo.bar
         - override: true
      ```
      ```json
      {
         "foo": {
            "bar": "B"
         }
      }
      ```
   </SampleCode>

   <Description>
      With multiple dotted fields, ...
   </Description>
   <SampleCode>
      ```json
      {
         "foo.bar": "A",
         "baz.qux": "B"
      }
      ```
   </SampleCode>
   <Description>
      using `*` expands all top-level ones:
   </Description>
   <SampleCode>
      ```yaml
      dot_expander:
         - field: "*"
      ```
      ```json
      {
         "foo": {
            "bar": "A"
         },
         "baz": {
            "qux": "B"
         }
      }
      ```
   </SampleCode>

   <Description>
      If the dotted fields have a common parent...
   </Description>
   <SampleCode>
      ```json
      {
         "foo": {
            "bar.baz": "A",
            "bar.qux": "B"
         }
      }
      ```
   </SampleCode>
   <Description>
      use `path` to group them:
   </Description>
   <SampleCode>
      ```yaml
      dot_expander:
         - path: foo
         - field: "*"
      ```
      ```json
      {
         "foo": {
            "bar": {
               "baz": "A",
               "qux": "B"
            }
         }
      }
      ```
   </SampleCode>

   <Description>
      If a potential name clash exists, ...
   </Description>
   <SampleCode>
      ```json
      {
         "foo": "A",
         "foo.bar": "B"
      }
      ```
   </SampleCode>
   <Description>
      use `rename` first to avoid overwriting a field:
   </Description>
   <SampleCode>
      ```yaml
      processors:
         - rename:
            - field: foo
            - target_field: foo.bar
         - dot_expander:
            - path: foo
            - field: "*"
      ```
      ```json
      {
         "foo": {
            "bar": ["A", "B"]
         }
      }
      ```
   </SampleCode>
</ExampleTable>

<Card shadow='tl'>
	<CardHeader>
		Since the expanded name, **foo_bar** is distinct, the part after the dot, **bar** becomes nested
	</CardHeader>
	<CardBody>
      ```json
      {
         "foo.bar": "A"
      }
      ```
      ```yaml
      dot_expander:
         - field: foo.bar
      ```
      ```json
      {
         "foo": {
            "bar": "A"
         }
      }
      ```
	</CardBody>
</Card>
