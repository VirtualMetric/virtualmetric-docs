# Conditional Running

Processors support an optional `if` field that uses the expr expression language for conditional execution.

## Basic Usage

If provided, the processor only runs when the condition evaluates to true. The condition has access to the current log entry context as `ctx`.

```yaml
processors:
  - drop:
      if: "ctx.network.direction != 'local'"
```

## Condition Types

### Null Checks

Check for null/nil values safely using optional chaining with `?`:

```yaml
- set:
    if: "ctx._temp_?.timezone_offset != null && ctx._temp_?.timezone_offset != 'local'"
    field: timezone
    value: "{{ctx._temp_.timezone_offset}}"

- drop:
    if: "ctx.observer.egress.interface.name == nil && ctx.network.direction == 'outbound'"
```

### Numeric Comparisons

Compare numeric values using standard operators:

```yaml
- set:
    if: "ctx.source?.packets > 5 && ctx.destination?.packets < 30"
    field: traffic_status
    value: "normal"
```

### Array Operations

Check array contents using `contains` and `notcontains` (or `!contains`):

```yaml
- drop:
    if: "['Drop', 'Reject', 'Block', 'Prevent'].contains(ctx.checkpoint?.rule_action)"

- set:
    if: "['Reject', 'Block', 'Prevent'].notcontains(ctx.checkpoint?.rule_action)"
    field: allow_status
    value: true
```

### String Operations

Work with strings using various methods:

```yaml
# Case-insensitive contains
- set:
    if: "ctx.checkpoint.product.toLowerCase().contains('example')"
    field: is_example
    value: true

# Using lower() function
- set:
    if: "lower(checkpoint.product) contains 'example'"
    field: is_example
    value: true
```

### Key Existence Checks

Check if fields or keys exist:

```yaml
- set:
    if: "ctx.containsKey('network')"
    field: has_network
    value: true

- set:
    if: "ctx.network.containsKey('direction')"
    field: has_direction
    value: true
```

## Complex Conditions

For better readability, complex conditions can be split across multiple lines using `>` in YAML:

```yaml
- set:
    if: >
      ctx?._temp_?.external_zones != null &&
      ctx?._temp_?.internal_zones != null &&
      ctx?.observer?.ingress?.zone != null &&
      ctx?.observer?.egress?.zone != null &&
      ctx._temp_.external_zones.contains(ctx.observer.egress.zone) &&
      ctx._temp_.external_zones.contains(ctx.observer.ingress.zone)
    field: zone_status
    value: "external"
```

## Pipeline Branching

The `if` condition can be used to conditionally execute different pipelines:

```yaml
processors:
  - pipeline:
      name: network_traffic
      if: "ctx?.source.packets != null && ctx.destination.packets != null"
  
  - pipeline:
      name: threat_detection
      if: "ctx.threat?.indicator?.confidence > 50"
  
  - fail:
      if: "ctx.network?.direction == nil"
      message: "Network direction must be specified"
```

:::note
Use optional chaining (`?.`) to safely access nested fields without causing null pointer exceptions.
:::

:::tip
Keep conditions simple and focused for better performance and maintainability.
:::