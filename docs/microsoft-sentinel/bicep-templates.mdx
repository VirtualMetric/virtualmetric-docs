# Bicep Templates

Microsoft Sentinel Data Collection Rules (DCR) Bicep Templates in VirtualMetric Director offer Infrastructure as Code (IaC) solutions for deploying standardized monitoring configurations. These templates enable automated and consistent deployment of Data Collection Rules across different Azure environments, making it easier to manage and scale your monitoring infrastructure.

## What is Bicep?

### Overview
Bicep is Microsoft Azure's domain-specific language (DSL) for deploying Azure resources. It provides a more concise and readable syntax compared to ARM (Azure Resource Manager) templates, while maintaining full compatibility with Azure's deployment capabilities. Bicep files are automatically transpiled into ARM templates during the deployment process.

Key features of Bicep include:
- Simpler syntax with reduced repetition and improved readability
- Type safety and enhanced validation at authoring time
- Modularity through composition of Bicep files
- IntelliSense and rich type safety in Visual Studio Code
- Direct integration with Azure deployment pipelines

Here's a simple example comparing JSON ARM template syntax with Bicep:

```bicep
// Bicep syntax
param location string = 'eastus'
param storageName string

resource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {
  name: storageName
  location: location
  sku: {
    name: 'Standard_LRS'
  }
  kind: 'StorageV2'
}
```

```json
// Equivalent ARM template JSON
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "eastus"
    },
    "storageName": {
      "type": "string"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-09-01",
      "name": "[parameters('storageName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2"
    }
  ]
}
```

## DCR Templates

Bicep simplifies the process of managing Azure infrastructure as code, making it easier to maintain and version control your Azure resource configurations.
VirtualMetric Director provides two specialized Bicep template categories.

### Standard

These templates generate DCRs that align with Microsoft Sentinel's native table schema. They include predefined parameters and variables for customizing data collection settings while maintaining compatibility with Sentinel's built-in analytics and workbooks. The templates are designed to facilitate seamless integration with your existing Sentinel deployments.

```bicep
@description('The location of the resources')
param location string 

@description('The name of the Data Collection Endpoint Id')
param dataCollectionEndpointId string

@description('The Log Analytics Workspace Id used for Sentinel')
param workspaceResourceId string

resource dataCollectionRule 'Microsoft.Insights/dataCollectionRules@2022-06-01' = {
  name: 'vmetric-dcr'
  location: location
  properties: {
    dataCollectionEndpointId: dataCollectionEndpointId
    streamDeclarations: {
      'Custom-CommonSecurityLog': {
        columns: [
          {
            name: 'TenantId'
            type: 'string'
          }        
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'DeviceVendor'
            type: 'string'
          }
          {
            name: 'DeviceProduct'
            type: 'string'
          }
          {
            name: 'DeviceVersion'
            type: 'string'
          }
          {
            name: 'DeviceEventClassID'
            type: 'string'
          }
          {
            name: 'Activity'
            type: 'string'
          }
          {
            name: 'LogSeverity'
            type: 'string'
          }
          {
            name: 'OriginalLogSeverity'
            type: 'string'
          }
          {
            name: 'AdditionalExtensions'
            type: 'string'
          }
          {
            name: 'DeviceAction'
            type: 'string'
          }
          {
            name: 'ApplicationProtocol'
            type: 'string'
          }
          {
            name: 'EventCount'
            type: 'int'
          }
          {
            name: 'DestinationDnsDomain'
            type: 'string'
          }
          {
            name: 'DestinationServiceName'
            type: 'string'
          }
          {
            name: 'DestinationTranslatedAddress'
            type: 'string'
          }
          {
            name: 'DestinationTranslatedPort'
            type: 'int'
          }
          {
            name: 'CommunicationDirection'
            type: 'string'
          }
          {
            name: 'DeviceDnsDomain'
            type: 'string'
          }
          {
            name: 'DeviceExternalID'
            type: 'string'
          }
          {
            name: 'DeviceFacility'
            type: 'string'
          }
          {
            name: 'DeviceInboundInterface'
            type: 'string'
          }
          {
            name: 'DeviceNtDomain'
            type: 'string'
          }
          {
            name: 'DeviceOutboundInterface'
            type: 'string'
          }
          {
            name: 'DevicePayloadId'
            type: 'string'
          }
          {
            name: 'ProcessName'
            type: 'string'
          }
          {
            name: 'DeviceTranslatedAddress'
            type: 'string'
          }
          {
            name: 'DestinationHostName'
            type: 'string'
          }
          {
            name: 'DestinationMACAddress'
            type: 'string'
          }
          {
            name: 'DestinationNTDomain'
            type: 'string'
          }
          {
            name: 'DestinationProcessId'
            type: 'int'
          }
          {
            name: 'DestinationUserPrivileges'
            type: 'string'
          }
          {
            name: 'DestinationProcessName'
            type: 'string'
          }
          {
            name: 'DestinationPort'
            type: 'int'
          }
          {
            name: 'DestinationIP'
            type: 'string'
          }
          {
            name: 'DeviceTimeZone'
            type: 'string'
          }
          {
            name: 'DestinationUserID'
            type: 'string'
          }
          {
            name: 'DestinationUserName'
            type: 'string'
          }
          {
            name: 'DeviceAddress'
            type: 'string'
          }
          {
            name: 'DeviceName'
            type: 'string'
          }
          {
            name: 'DeviceMacAddress'
            type: 'string'
          }
          {
            name: 'ProcessID'
            type: 'int'
          }
          {
            name: 'EndTime'
            type: 'datetime'
          }
          {
            name: 'ExternalID'
            type: 'int'
          }
          {
            name: 'ExtID'
            type: 'string'
          }
          {
            name: 'FileCreateTime'
            type: 'string'
          }
          {
            name: 'FileHash'
            type: 'string'
          }
          {
            name: 'FileID'
            type: 'string'
          }
          {
            name: 'FileModificationTime'
            type: 'string'
          }
          {
            name: 'FilePath'
            type: 'string'
          }
          {
            name: 'FilePermission'
            type: 'string'
          }
          {
            name: 'FileType'
            type: 'string'
          }
          {
            name: 'FileName'
            type: 'string'
          }
          {
            name: 'FileSize'
            type: 'int'
          }
          {
            name: 'ReceivedBytes'
            type: 'long'
          }
          {
            name: 'Message'
            type: 'string'
          }
          {
            name: 'OldFileCreateTime'
            type: 'string'
          }
          {
            name: 'OldFileHash'
            type: 'string'
          }
          {
            name: 'OldFileID'
            type: 'string'
          }
          {
            name: 'OldFileModificationTime'
            type: 'string'
          }
          {
            name: 'OldFileName'
            type: 'string'
          }
          {
            name: 'OldFilePath'
            type: 'string'
          }
          {
            name: 'OldFilePermission'
            type: 'string'
          }
          {
            name: 'OldFileSize'
            type: 'int'
          }
          {
            name: 'OldFileType'
            type: 'string'
          }
          {
            name: 'SentBytes'
            type: 'long'
          }
          {
            name: 'EventOutcome'
            type: 'string'
          }
          {
            name: 'Protocol'
            type: 'string'
          }
          {
            name: 'Reason'
            type: 'string'
          }
          {
            name: 'RequestURL'
            type: 'string'
          }
          {
            name: 'RequestClientApplication'
            type: 'string'
          }
          {
            name: 'RequestContext'
            type: 'string'
          }
          {
            name: 'RequestCookies'
            type: 'string'
          }
          {
            name: 'RequestMethod'
            type: 'string'
          }
          {
            name: 'ReceiptTime'
            type: 'string'
          }
          {
            name: 'SourceMACAddress'
            type: 'string'
          }
          {
            name: 'SourceNTDomain'
            type: 'string'
          }
          {
            name: 'SourceDnsDomain'
            type: 'string'
          }
          {
            name: 'SourceServiceName'
            type: 'string'
          }
          {
            name: 'SourceTranslatedAddress'
            type: 'string'
          }
          {
            name: 'SourceTranslatedPort'
            type: 'int'
          }
          {
            name: 'SourceProcessId'
            type: 'int'
          }
          {
            name: 'SourceUserPrivileges'
            type: 'string'
          }
          {
            name: 'SourceProcessName'
            type: 'string'
          }
          {
            name: 'SourcePort'
            type: 'int'
          }
          {
            name: 'SourceIP'
            type: 'string'
          }
          {
            name: 'StartTime'
            type: 'datetime'
          }
          {
            name: 'SourceUserID'
            type: 'string'
          }
          {
            name: 'SourceUserName'
            type: 'string'
          }
          {
            name: 'EventType'
            type: 'int'
          }
          {
            name: 'DeviceEventCategory'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address1'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address1Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address2'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address2Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address3'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address3Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address4'
            type: 'string'
          }
          {
            name: 'DeviceCustomIPv6Address4Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomFloatingPoint1'
            type: 'real'
          }
          {
            name: 'DeviceCustomFloatingPoint1Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomFloatingPoint2'
            type: 'real'
          }
          {
            name: 'DeviceCustomFloatingPoint2Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomFloatingPoint3'
            type: 'real'
          }
          {
            name: 'DeviceCustomFloatingPoint3Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomFloatingPoint4'
            type: 'real'
          }
          {
            name: 'DeviceCustomFloatingPoint4Label'
            type: 'string'
          }          
          {
            name: 'DeviceCustomNumber1'
            type: 'int'
          }
          {
            name: 'FieldDeviceCustomNumber1'
            type: 'long'
          }
          {
            name: 'DeviceCustomNumber1Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomNumber2'
            type: 'int'
          }
          {
            name: 'FieldDeviceCustomNumber2'
            type: 'long'
          }
          {
            name: 'DeviceCustomNumber2Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomNumber3'
            type: 'int'
          }
          {
            name: 'FieldDeviceCustomNumber3'
            type: 'long'
          }
          {
            name: 'DeviceCustomNumber3Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString1'
            type: 'string'
          }
          {
            name: 'DeviceCustomString1Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString2'
            type: 'string'
          }
          {
            name: 'DeviceCustomString2Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString3'
            type: 'string'
          }
          {
            name: 'DeviceCustomString3Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString4'
            type: 'string'
          }
          {
            name: 'DeviceCustomString4Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString5'
            type: 'string'
          }
          {
            name: 'DeviceCustomString5Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomString6'
            type: 'string'
          }
          {
            name: 'DeviceCustomString6Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomDate1'
            type: 'string'
          }
          {
            name: 'DeviceCustomDate1Label'
            type: 'string'
          }
          {
            name: 'DeviceCustomDate2'
            type: 'string'
          }
          {
            name: 'DeviceCustomDate2Label'
            type: 'string'
          }
          {
            name: 'FlexDate1'
            type: 'string'
          }
          {
            name: 'FlexDate1Label'
            type: 'string'
          }
          {
            name: 'FlexNumber1'
            type: 'int'
          }
          {
            name: 'FlexNumber1Label'
            type: 'string'
          }
          {
            name: 'FlexNumber2'
            type: 'int'
          }
          {
            name: 'FlexNumber2Label'
            type: 'string'
          }
          {
            name: 'FlexString1'
            type: 'string'
          }
          {
            name: 'FlexString1Label'
            type: 'string'
          }
          {
            name: 'FlexString2'
            type: 'string'
          }
          {
            name: 'FlexString2Label'
            type: 'string'
          }
          {
            name: 'RemoteIP'
            type: 'string'
          }
          {
            name: 'RemotePort'
            type: 'string'
          }
          {
            name: 'MaliciousIP'
            type: 'string'
          }
          {
            name: 'ThreatSeverity'
            type: 'int'
          }
          {
            name: 'IndicatorThreatType'
            type: 'string'
          }
          {
            name: 'ThreatDescription'
            type: 'string'
          }
          {
            name: 'ThreatConfidence'
            type: 'string'
          }
          {
            name: 'ReportReferenceLink'
            type: 'string'
          }
          {
            name: 'MaliciousIPLongitude'
            type: 'real'
          }
          {
            name: 'MaliciousIPLatitude'
            type: 'real'
          }
          {
            name: 'MaliciousIPCountry'
            type: 'string'
          }
          {
            name: 'Computer'
            type: 'string'
          }
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'SimplifiedDeviceAction'
            type: 'string'
          }
          {
            name: 'CollectorHostName'
            type: 'string'
          }
          {
            name: 'Type'
            type: 'string'
          }
        ]
        'Custom-SecurityEvent': {
        columns: [
          {
            name: 'TenantId'
            type: 'string'
          }           
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'AccessList'
            type: 'string'
          }
          {
            name: 'AccessMask'
            type: 'string'
          }
          {
            name: 'AccessReason'
            type: 'string'
          }
          {
            name: 'Account'
            type: 'string'
          }
          {
            name: 'AccountDomain'
            type: 'string'
          }
          {
            name: 'AccountExpires'
            type: 'string'
          }
          {
            name: 'AccountName'
            type: 'string'
          }
          {
            name: 'AccountType'
            type: 'string'
          }
          {
            name: 'AccountSessionIdentifier'
            type: 'string'
          }
          {
            name: 'Activity'
            type: 'string'
          }
          {
            name: 'AdditionalInfo'
            type: 'string'
          }
          {
            name: 'AdditionalInfo2'
            type: 'string'
          }
          {
            name: 'AllowedToDelegateTo'
            type: 'string'
          }
          {
            name: 'Attributes'
            type: 'string'
          }
          {
            name: 'AuditPolicyChanges'
            type: 'string'
          }
          {
            name: 'AuditsDiscarded'
            type: 'int'
          }
          {
            name: 'AuthenticationLevel'
            type: 'int'
          }
          {
            name: 'AuthenticationPackageName'
            type: 'string'
          }
          {
            name: 'AuthenticationProvider'
            type: 'string'
          }
          {
            name: 'AuthenticationServer'
            type: 'string'
          }
          {
            name: 'AuthenticationService'
            type: 'int'
          }
          {
            name: 'AuthenticationType'
            type: 'string'
          }
          {
            name: 'AzureDeploymentID'
            type: 'string'
          }
          {
            name: 'AzureTableName'
            type: 'string'
          }
          {
            name: 'CACertificateHash'
            type: 'string'
          }
          {
            name: 'CalledStationID'
            type: 'string'
          }
          {
            name: 'CallerProcessId'
            type: 'string'
          }
          {
            name: 'CallerProcessName'
            type: 'string'
          }
          {
            name: 'CallingStationID'
            type: 'string'
          }
          {
            name: 'CAPublicKeyHash'
            type: 'string'
          }
          {
            name: 'CategoryId'
            type: 'string'
          }          
          {
            name: 'CertificateDatabaseHash'
            type: 'string'
          }
          {
            name: 'Channel'
            type: 'string'
          }
          {
            name: 'ClassId'
            type: 'string'
          }
          {
            name: 'ClassName'
            type: 'string'
          }
          {
            name: 'ClientAddress'
            type: 'string'
          }
          {
            name: 'ClientIPAddress'
            type: 'string'
          }
          {
            name: 'ClientName'
            type: 'string'
          }
          {
            name: 'CommandLine'
            type: 'string'
          }
          {
            name: 'CompatibleIds'
            type: 'string'
          }
          {
            name: 'Computer'
            type: 'string'
          }
          {
            name: 'DCDNSName'
            type: 'string'
          }
          {
            name: 'DeviceDescription'
            type: 'string'
          }
          {
            name: 'DeviceId'
            type: 'string'
          }
          {
            name: 'DisplayName'
            type: 'string'
          }
          {
            name: 'Disposition'
            type: 'string'
          }
          {
            name: 'DomainBehaviorVersion'
            type: 'string'
          }
          {
            name: 'DomainName'
            type: 'string'
          }          
          {
            name: 'DomainPolicyChanged'
            type: 'string'
          }
          {
            name: 'DomainSid'
            type: 'string'
          }
          {
            name: 'EAPType'
            type: 'string'
          }
          {
            name: 'ElevatedToken'
            type: 'string'
          }
          {
            name: 'ErrorCode'
            type: 'int'
          }
          {
            name: 'EventData'
            type: 'string'
          }
          {
            name: 'EventID'
            type: 'int'
          }
          {
            name: 'EventOriginId'
            type: 'string'
          }
          {
            name: 'EventSourceName'
            type: 'string'
          }
          {
            name: 'ExtendedQuarantineState'
            type: 'string'
          }
          {
            name: 'FailureReason'
            type: 'string'
          }
          {
            name: 'FileHash'
            type: 'string'
          }
          {
            name: 'FilePath'
            type: 'string'
          }
          {
            name: 'FilePathNoUser'
            type: 'string'
          }
          {
            name: 'Filter'
            type: 'string'
          }
          {
            name: 'ForceLogoff'
            type: 'string'
          }
          {
            name: 'Fqbn'
            type: 'string'
          }
          {
            name: 'FullyQualifiedSubjectMachineName'
            type: 'string'
          }
          {
            name: 'FullyQualifiedSubjectUserName'
            type: 'string'
          }
          {
            name: 'GroupMembership'
            type: 'string'
          }
          {
            name: 'HandleId'
            type: 'string'
          }
          {
            name: 'HardwareIds'
            type: 'string'
          }
          {
            name: 'HomeDirectory'
            type: 'string'
          }
          {
            name: 'HomePath'
            type: 'string'
          }
          {
            name: 'ImpersonationLevel'
            type: 'string'
          }
          {
            name: 'InterfaceUuid'
            type: 'string'
          }
          {
            name: 'IpAddress'
            type: 'string'
          }
          {
            name: 'IpPort'
            type: 'string'
          }
          {
            name: 'KeyLength'
            type: 'int'
          }
          {
            name: 'Level'
            type: 'string'
          }
          {
            name: 'LmPackageName'
            type: 'string'
          }
          {
            name: 'LocationInformation'
            type: 'string'
          }
          {
            name: 'LockoutDuration'
            type: 'string'
          }
          {
            name: 'LockoutObservationWindow'
            type: 'string'
          }
          {
            name: 'LockoutThreshold'
            type: 'string'
          }
          {
            name: 'LoggingResult'
            type: 'string'
          }
          {
            name: 'LogonGuid'
            type: 'string'
          }
          {
            name: 'LogonHours'
            type: 'string'
          }
          {
            name: 'LogonID'
            type: 'string'
          }
          {
            name: 'LogonProcessName'
            type: 'string'
          }
          {
            name: 'LogonType'
            type: 'int'
          }
          {
            name: 'LogonTypeName'
            type: 'string'
          }
          {
            name: 'MachineAccountQuota'
            type: 'string'
          }
          {
            name: 'MachineInventory'
            type: 'string'
          }
          {
            name: 'MachineLogon'
            type: 'string'
          }
          {
            name: 'ManagementGroupName'
            type: 'string'
          }
          {
            name: 'MandatoryLabel'
            type: 'string'
          }
          {
            name: 'MaxPasswordAge'
            type: 'string'
          }
          {
            name: 'MemberName'
            type: 'string'
          }
          {
            name: 'MemberSid'
            type: 'string'
          }
          {
            name: 'MG'
            type: 'string'
          }
          {
            name: 'MinPasswordAge'
            type: 'string'
          }
          {
            name: 'MinPasswordLength'
            type: 'string'
          }
          {
            name: 'MixedDomainMode'
            type: 'string'
          }
          {
            name: 'NASIdentifier'
            type: 'string'
          }
          {
            name: 'NASIPv4Address'
            type: 'string'
          }
          {
            name: 'NASIPv6Address'
            type: 'string'
          }
          {
            name: 'NASPort'
            type: 'string'
          }
          {
            name: 'NASPortType'
            type: 'string'
          }
          {
            name: 'NetworkPolicyName'
            type: 'string'
          }
          {
            name: 'NewDate'
            type: 'string'
          }
          {
            name: 'NewMaxUsers'
            type: 'string'
          }
          {
            name: 'NewProcessId'
            type: 'string'
          }
          {
            name: 'NewProcessName'
            type: 'string'
          }
          {
            name: 'NewRemark'
            type: 'string'
          }
          {
            name: 'NewShareFlags'
            type: 'string'
          }
          {
            name: 'NewTime'
            type: 'string'
          }
          {
            name: 'NewUacValue'
            type: 'string'
          }
          {
            name: 'NewValue'
            type: 'string'
          }
          {
            name: 'NewValueType'
            type: 'string'
          }
          {
            name: 'ObjectName'
            type: 'string'
          }
          {
            name: 'ObjectServer'
            type: 'string'
          }
          {
            name: 'ObjectType'
            type: 'string'
          }
          {
            name: 'ObjectValueName'
            type: 'string'
          }
          {
            name: 'OemInformation'
            type: 'string'
          }
          {
            name: 'OldMaxUsers'
            type: 'string'
          }
          {
            name: 'OldRemark'
            type: 'string'
          }
          {
            name: 'OldShareFlags'
            type: 'string'
          }
          {
            name: 'OldUacValue'
            type: 'string'
          }
          {
            name: 'OldValue'
            type: 'string'
          }
          {
            name: 'OldValueType'
            type: 'string'
          }
          {
            name: 'OperationType'
            type: 'string'
          }
          {
            name: 'PackageName'
            type: 'string'
          }
          {
            name: 'ParentProcessName'
            type: 'string'
          }
          {
            name: 'PartitionKey'
            type: 'string'
          }
          {
            name: 'PasswordHistoryLength'
            type: 'string'
          }
          {
            name: 'PasswordLastSet'
            type: 'string'
          }
          {
            name: 'PasswordProperties'
            type: 'string'
          }
          {
            name: 'PreviousDate'
            type: 'string'
          }
          {
            name: 'PreviousTime'
            type: 'string'
          }
          {
            name: 'PrimaryGroupId'
            type: 'string'
          }
          {
            name: 'PrivateKeyUsageCount'
            type: 'string'
          }
          {
            name: 'PrivilegeList'
            type: 'string'
          }
          {
            name: 'Process'
            type: 'string'
          }
          {
            name: 'ProcessId'
            type: 'string'
          }
          {
            name: 'ProcessName'
            type: 'string'
          }
          {
            name: 'Properties'
            type: 'string'
          }
          {
            name: 'ProfilePath'
            type: 'string'
          }
          {
            name: 'ProtocolSequence'
            type: 'string'
          }
          {
            name: 'ProxyPolicyName'
            type: 'string'
          }
          {
            name: 'QuarantineHelpURL'
            type: 'string'
          }
          {
            name: 'QuarantineSessionID'
            type: 'string'
          }
          {
            name: 'QuarantineSessionIdentifier'
            type: 'string'
          }
          {
            name: 'QuarantineState'
            type: 'string'
          }
          {
            name: 'QuarantineSystemHealthResult'
            type: 'string'
          }
          {
            name: 'RelativeTargetName'
            type: 'string'
          }
          {
            name: 'RemoteIpAddress'
            type: 'string'
          }
          {
            name: 'RemotePort'
            type: 'string'
          }
          {
            name: 'Requester'
            type: 'string'
          }
          {
            name: 'RequestId'
            type: 'string'
          }
          {
            name: 'RestrictedAdminMode'
            type: 'string'
          }
          {
            name: 'RowKey'
            type: 'string'
          }
          {
            name: 'RowsDeleted'
            type: 'string'
          }
          {
            name: 'SamAccountName'
            type: 'string'
          }
          {
            name: 'ScriptPath'
            type: 'string'
          }
          {
            name: 'SecurityDescriptor'
            type: 'string'
          }
          {
            name: 'ServiceAccount'
            type: 'string'
          }
          {
            name: 'ServiceFileName'
            type: 'string'
          }
          {
            name: 'ServiceName'
            type: 'string'
          }
          {
            name: 'ServiceStartType'
            type: 'int'
          }
          {
            name: 'ServiceType'
            type: 'string'
          }
          {
            name: 'SessionName'
            type: 'string'
          }
          {
            name: 'ShareLocalPath'
            type: 'string'
          }
          {
            name: 'ShareName'
            type: 'string'
          }
          {
            name: 'SidHistory'
            type: 'string'
          }
          {
            name: 'SourceComputerId'
            type: 'string'
          }
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'Status'
            type: 'string'
          }
          {
            name: 'StorageAccount'
            type: 'string'
          }
          {
            name: 'SubjectAccount'
            type: 'string'
          }
          {
            name: 'SubcategoryGuid'
            type: 'string'
          }
          {
            name: 'SubcategoryId'
            type: 'string'
          }
          {
            name: 'Subject'
            type: 'string'
          }
          {
            name: 'SubjectDomainName'
            type: 'string'
          }
          {
            name: 'SubjectKeyIdentifier'
            type: 'string'
          }
          {
            name: 'SubjectLogonId'
            type: 'string'
          }
          {
            name: 'SubjectMachineName'
            type: 'string'
          }
          {
            name: 'SubjectMachineSID'
            type: 'string'
          }
          {
            name: 'SubjectUserName'
            type: 'string'
          }
          {
            name: 'SubjectUserSid'
            type: 'string'
          }
          {
            name: 'SubStatus'
            type: 'string'
          }
          {
            name: 'TableId'
            type: 'string'
          }
          {
            name: 'TargetAccount'
            type: 'string'
          }
          {
            name: 'TargetDomainName'
            type: 'string'
          }
          {
            name: 'TargetInfo'
            type: 'string'
          }
          {
            name: 'TargetLinkedLogonId'
            type: 'string'
          }
          {
            name: 'TargetLogonGuid'
            type: 'string'
          }
          {
            name: 'TargetLogonId'
            type: 'string'
          }
          {
            name: 'TargetOutboundDomainName'
            type: 'string'
          }
          {
            name: 'TargetOutboundUserName'
            type: 'string'
          }
          {
            name: 'TargetServerName'
            type: 'string'
          }
          {
            name: 'TargetSid'
            type: 'string'
          }
          {
            name: 'TargetUser'
            type: 'string'
          }
          {
            name: 'TargetUserName'
            type: 'string'
          }
          {
            name: 'TargetUserSid'
            type: 'string'
          }
          {
            name: 'Task'
            type: 'int'
          }
          {
            name: 'TemplateContent'
            type: 'string'
          }
          {
            name: 'TemplateDSObjectFQDN'
            type: 'string'
          }
          {
            name: 'TemplateInternalName'
            type: 'string'
          }
          {
            name: 'TemplateOID'
            type: 'string'
          }
          {
            name: 'TemplateSchemaVersion'
            type: 'string'
          }
          {
            name: 'TemplateVersion'
            type: 'string'
          }
          {
            name: 'TimeCollected'
            type: 'datetime'
          }
          {
            name: 'TokenElevationType'
            type: 'string'
          }
          {
            name: 'TransmittedServices'
            type: 'string'
          }
          {
            name: 'Type'
            type: 'string'
          }
          {
            name: 'UserAccountControl'
            type: 'string'
          }
          {
            name: 'UserParameters'
            type: 'string'
          }
          {
            name: 'UserPrincipalName'
            type: 'string'
          }
          {
            name: 'UserWorkstations'
            type: 'string'
          }
          {
            name: 'VirtualAccount'
            type: 'string'
          }
          {
            name: 'VendorIds'
            type: 'string'
          }
          {
            name: 'Workstation'
            type: 'string'
          }
          {
            name: 'WorkstationName'
            type: 'string'
          }
        ]
        'Custom-Syslog': {
        columns: [
          {
            name: 'TenantId'
            type: 'string'
          }          
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'Computer'
            type: 'string'
          }
          {
            name: 'EventTime'
            type: 'datetime'
          }
          {
            name: 'Facility'
            type: 'string'
          }
          {
            name: 'HostName'
            type: 'string'
          }
          {
            name: 'SeverityLevel'
            type: 'string'
          }
          {
            name: 'SyslogMessage'
            type: 'string'
          }
          {
            name: 'ProcessID'
            type: 'int'
          }
          {
            name: 'HostIP'
            type: 'string'
          }
          {
            name: 'ProcessName'
            type: 'string'
          }
          {
            name: 'CollectorHostName'
            type: 'string'
          }
          {
            name: 'Type'
            type: 'string'
          }
        ]
        'Custom-WindowsEvent': {
        columns: [ 
          {
            name: 'TenantId'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'Channel'
            type: 'string'
          }
          {
            name: 'Computer'
            type: 'string'
          }
          {
            name: 'Version'
            type: 'int'
          }
          {
            name: 'Data'
            type: 'string'
          }
          {
            name: 'Opcode'
            type: 'string'
          }
          {
            name: 'RawEventData'
            type: 'string'
          }
          {
            name: 'SystemUserId'
            type: 'string'
          }
          {
            name: 'TimeCreated'
            type: 'datetime'
          }
          {
            name: 'ManagementGroupName'
            type: 'string'
          }
          {
            name: 'Keywords'
            type: 'string'
          }
          {
            name: 'Correlation'
            type: 'string'
          }
          {
            name: 'SystemProcessId'
            type: 'int'
          }
          {
            name: 'SystemThreadId'
            type: 'int'
          }
          {
            name: 'EventRecordId'
            type: 'string'
          }
          {
            name: 'Provider'
            type: 'string'
          }
          {
            name: 'EventID'
            type: 'int'
          }
          {
            name: 'Task'
            type: 'int'
          }
          {
            name: 'EventOriginId'
            type: 'string'
          }
          {
            name: 'EventLevel'
            type: 'int'
          }
          {
            name: 'EventLevelName'
            type: 'string'
          }
          {
            name: 'EventData'
            type: 'string'
          }
        ]
    }
    destinations: {
      logAnalytics: [
        {
          workspaceResourceId: workspaceResourceId
          name: 'vmetric-datastream'
        }
      ]
    }
    dataFlows: [
      {
        streams: [
          'Custom-CommonSecurityLog'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-CommonSecurityLog'
      }
      {
        streams: [
          'Custom-SecurityEvent'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-SecurityEvent'
      }
      {
        streams: [
          'Custom-Syslog'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-Syslog'
      }
      {
        streams: [
          'Custom-WindowsEvent'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-WindowsEvent'
      }
    ]
  }
}

output immutableId string = dataCollectionRule.properties.immutableId
```

### ASim

These templates create DCRs that implement the Advanced Security Information Model (ASIM) schema. They include specific parsers and transformations required for normalizing VirtualMetric data into ASIM-compliant formats. These templates ensure your security data is standardized across different sources, enhancing threat detection and investigation capabilities.

```bicep
@description('The location of the resources')
param location string 

@description('The name of the Data Collection Endpoint Id')
param dataCollectionEndpointId string

@description('The Log Analytics Workspace Id used for Sentinel')
param workspaceResourceId string

resource dataCollectionRule 'Microsoft.Insights/dataCollectionRules@2022-06-01' = {
  name: 'vmetric-dcr'
  location: location
  properties: {
    dataCollectionEndpointId: dataCollectionEndpointId
    streamDeclarations: {
      'Custom-ASimAuditEventLogs': {
        columns: [ 
          {
            name: 'TenantId'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'EventType'
            type: 'string'
          }
          {
            name: 'NewValue'
            type: 'string'
          }
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'EventMessage'
            type: 'string'
          }
          {
            name: 'ObjectId'
            type: 'string'
          }
          {
            name: 'RuleName'
            type: 'string'
          }
          {
            name: 'EventCount'
            type: 'int'
          }
          {
            name: 'EventStartTime'
            type: 'datetime'
          }
          {
            name: 'EventEndTime'
            type: 'datetime'
          }
          {
            name: 'EventSubType'
            type: 'string'
          }
          {
            name: 'EventResult'
            type: 'string'
          }
          {
            name: 'EventResultDetails'
            type: 'string'
          }
          {
            name: 'EventOriginalUid'
            type: 'string'
          }
          {
            name: 'EventOriginalType'
            type: 'string'
          }
          {
            name: 'EventOriginalSubType'
            type: 'string'
          }
          {
            name: 'EventOriginalResultDetails'
            type: 'string'
          }
          {
            name: 'EventSeverity'
            type: 'string'
          }
          {
            name: 'EventOriginalSeverity'
            type: 'string'
          }
          {
            name: 'EventProduct'
            type: 'string'
          }
          {
            name: 'EventProductVersion'
            type: 'string'
          }
          {
            name: 'EventVendor'
            type: 'string'
          }
          {
            name: 'EventSchemaVersion'
            type: 'string'
          }
          {
            name: 'EventOwner'
            type: 'string'
          }
          {
            name: 'EventReportUrl'
            type: 'string'
          }
          {
            name: 'RuleNumber'
            type: 'int'
          }
          {
            name: 'ThreatId'
            type: 'string'
          }
          {
            name: 'ThreatName'
            type: 'string'
          }
          {
            name: 'ThreatCategory'
            type: 'string'
          }
          {
            name: 'ThreatRiskLevel'
            type: 'int'
          }
          {
            name: 'ThreatOriginalRiskLevel'
            type: 'string'
          }
          {
            name: 'ThreatConfidence'
            type: 'int'
          }
          {
            name: 'ThreatOriginalConfidence'
            type: 'string'
          }
          {
            name: 'ThreatIsActive'
            type: 'boolean'
          }
          {
            name: 'ThreatFirstReportedTime'
            type: 'datetime'
          }
          {
            name: 'ThreatLastReportedTime'
            type: 'datetime'
          }
          {
            name: 'ThreatField'
            type: 'string'
          }
          {
            name: 'ThreatIpAddr'
            type: 'string'
          }
          {
            name: 'DvcIpAddr'
            type: 'string'
          }
          {
            name: 'DvcHostname'
            type: 'string'
          }
          {
            name: 'DvcDomain'
            type: 'string'
          }
          {
            name: 'DvcDomainType'
            type: 'string'
          }
          {
            name: 'DvcFQDN'
            type: 'string'
          }
          {
            name: 'DvcDescription'
            type: 'string'
          }
          {
            name: 'DvcId'
            type: 'string'
          }
          {
            name: 'DvcIdType'
            type: 'string'
          }
          {
            name: 'DvcMacAddr'
            type: 'string'
          }
          {
            name: 'DvcZone'
            type: 'string'
          }
          {
            name: 'DvcOs'
            type: 'string'
          }
          {
            name: 'DvcOsVersion'
            type: 'string'
          }
          {
            name: 'DvcAction'
            type: 'string'
          }
          {
            name: 'DvcOriginalAction'
            type: 'string'
          }
          {
            name: 'DvcInterface'
            type: 'string'
          }
          {
            name: 'DvcScopeId'
            type: 'string'
          }
          {
            name: 'DvcScope'
            type: 'string'
          }
          {
            name: 'ActorUserId'
            type: 'string'
          }
          {
            name: 'ActorUserAadId'
            type: 'string'
          }
          {
            name: 'ObjectType'
            type: 'string'
          }
          {
            name: 'HttpUserAgent'
            type: 'string'
          }
          {
            name: 'AdditionalFields'
            type: 'string'
          }
          {
            name: 'ActorUserSid'
            type: 'string'
          }
          {
            name: 'ActorUserIdType'
            type: 'string'
          }
          {
            name: 'ActorScopeId'
            type: 'string'
          }
          {
            name: 'ActorScope'
            type: 'string'
          }
          {
            name: 'ActorUsername'
            type: 'string'
          }
          {
            name: 'ActorUsernameType'
            type: 'string'
          }
          {
            name: 'ActorUserType'
            type: 'string'
          }
          {
            name: 'ActorOriginalUserType'
            type: 'string'
          }
          {
            name: 'ActorSessionId'
            type: 'string'
          }
          {
            name: 'TargetAppId'
            type: 'string'
          }
          {
            name: 'TargetAppName'
            type: 'string'
          }
          {
            name: 'TargetAppType'
            type: 'string'
          }
          {
            name: 'TargetOriginalAppType'
            type: 'string'
          }
          {
            name: 'TargetUrl'
            type: 'string'
          }
          {
            name: 'ActingAppId'
            type: 'string'
          }
          {
            name: 'ActingAppName'
            type: 'string'
          }
          {
            name: 'ActingAppType'
            type: 'string'
          }
          {
            name: 'ActingOriginalAppType'
            type: 'string'
          }
          {
            name: 'SrcIpAddr'
            type: 'string'
          }
          {
            name: 'SrcPortNumber'
            type: 'int'
          }
          {
            name: 'SrcHostname'
            type: 'string'
          }
          {
            name: 'SrcDomain'
            type: 'string'
          }
          {
            name: 'SrcDomainType'
            type: 'string'
          }
          {
            name: 'SrcFQDN'
            type: 'string'
          }
          {
            name: 'SrcDescription'
            type: 'string'
          }
          {
            name: 'SrcDvcId'
            type: 'string'
          }
          {
            name: 'SrcDvcIdType'
            type: 'string'
          }
          {
            name: 'SrcDvcScopeId'
            type: 'string'
          }
          {
            name: 'SrcDvcScope'
            type: 'string'
          }
          {
            name: 'SrcDeviceType'
            type: 'string'
          }
          {
            name: 'SrcGeoCountry'
            type: 'string'
          }
          {
            name: 'SrcGeoLatitude'
            type: 'string'
          }
          {
            name: 'SrcGeoLongitude'
            type: 'string'
          }
          {
            name: 'SrcGeoRegion'
            type: 'string'
          }
          {
            name: 'SrcGeoCity'
            type: 'string'
          }
          {
            name: 'SrcRiskLevel'
            type: 'int'
          }
          {
            name: 'SrcOriginalRiskLevel'
            type: 'string'
          }
          {
            name: 'TargetIpAddr'
            type: 'string'
          }
          {
            name: 'TargetPortNumber'
            type: 'int'
          }
          {
            name: 'TargetHostname'
            type: 'string'
          }
          {
            name: 'TargetDomain'
            type: 'string'
          }
          {
            name: 'TargetDomainType'
            type: 'string'
          }
          {
            name: 'TargetFQDN'
            type: 'string'
          }
          {
            name: 'TargetDescription'
            type: 'string'
          }
          {
            name: 'TargetDvcId'
            type: 'string'
          }
          {
            name: 'TargetDvcIdType'
            type: 'string'
          }
          {
            name: 'TargetDvcScopeId'
            type: 'string'
          }
          {
            name: 'TargetDvcScope'
            type: 'string'
          }
          {
            name: 'TargetDeviceType'
            type: 'string'
          }
          {
            name: 'TargetGeoCountry'
            type: 'string'
          }
          {
            name: 'TargetGeoLatitude'
            type: 'string'
          }
          {
            name: 'TargetGeoLongitude'
            type: 'string'
          }
          {
            name: 'TargetGeoRegion'
            type: 'string'
          }
          {
            name: 'TargetGeoCity'
            type: 'string'
          }
          {
            name: 'TargetRiskLevel'
            type: 'int'
          }
          {
            name: 'TargetOriginalRiskLevel'
            type: 'string'
          }
          {
            name: 'TargetDvcOs'
            type: 'string'
          }
          {
            name: 'Operation'
            type: 'string'
          }
          {
            name: 'Object'
            type: 'string'
          }
          {
            name: 'OriginalObjectType'
            type: 'string'
          }
          {
            name: 'OldValue'
            type: 'string'
          }
          {
            name: 'ValueType'
            type: 'string'
          }
        ]
        'Custom-ASimDhcpEventLogs': {
        columns: [ 
          {
            name: 'TenantId'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'EventType'
            type: 'string'
          }
          {
            name: 'SourceSystem'
            type: 'string'
          }
          {
            name: 'EventMessage'
            type: 'string'
          }
          {
            name: 'RuleName'
            type: 'string'
          }
          {
            name: 'EventCount'
            type: 'int'
          }
          {
            name: 'EventStartTime'
            type: 'datetime'
          }
          {
            name: 'EventEndTime'
            type: 'datetime'
          }
          {
            name: 'EventSubType'
            type: 'string'
          }
          {
            name: 'EventResult'
            type: 'string'
          }
          {
            name: 'EventResultDetails'
            type: 'string'
          }
          {
            name: 'EventOriginalUid'
            type: 'string'
          }
          {
            name: 'EventOriginalType'
            type: 'string'
          }
          {
            name: 'EventOriginalSubType'
            type: 'string'
          }
          {
            name: 'EventOriginalResultDetails'
            type: 'string'
          }
          {
            name: 'EventSeverity'
            type: 'string'
          }
          {
            name: 'EventOriginalSeverity'
            type: 'string'
          }
          {
            name: 'EventProduct'
            type: 'string'
          }
          {
            name: 'EventProductVersion'
            type: 'string'
          }
          {
            name: 'EventVendor'
            type: 'string'
          }
          {
            name: 'EventSchemaVersion'
            type: 'string'
          }
          {
            name: 'EventOwner'
            type: 'string'
          }
          {
            name: 'EventReportUrl'
            type: 'string'
          }
          {
            name: 'RuleNumber'
            type: 'int'
          }
          {
            name: 'ThreatId'
            type: 'string'
          }
          {
            name: 'ThreatName'
            type: 'string'
          }
          {
            name: 'ThreatCategory'
            type: 'string'
          }
          {
            name: 'ThreatRiskLevel'
            type: 'int'
          }
          {
            name: 'ThreatOriginalRiskLevel'
            type: 'string'
          }
          {
            name: 'ThreatConfidence'
            type: 'int'
          }
          {
            name: 'ThreatOriginalConfidence'
            type: 'string'
          }
          {
            name: 'ThreatIsActive'
            type: 'boolean'
          }
          {
            name: 'ThreatFirstReportedTime'
            type: 'datetime'
          }
          {
            name: 'ThreatLastReportedTime'
            type: 'datetime'
          }
          {
            name: 'ThreatField'
            type: 'string'
          }
          {
            name: 'DvcIpAddr'
            type: 'string'
          }
          {
            name: 'DvcHostname'
            type: 'string'
          }
          {
            name: 'DvcDomain'
            type: 'string'
          }
          {
            name: 'DvcDomainType'
            type: 'string'
          }
          {
            name: 'DvcFQDN'
            type: 'string'
          }
          {
            name: 'DvcDescription'
            type: 'string'
          }
          {
            name: 'DvcId'
            type: 'string'
          }
          {
            name: 'DvcIdType'
            type: 'string'
          }
          {
            name: 'DvcMacAddr'
            type: 'string'
          }
          {
            name: 'DvcZone'
            type: 'string'
          }
          {
            name: 'DvcOs'
            type: 'string'
          }
          {
            name: 'DvcOsVersion'
            type: 'string'
          }
          {
            name: 'DvcAction'
            type: 'string'
          }
          {
            name: 'DvcOriginalAction'
            type: 'string'
          }
          {
            name: 'DvcInterface'
            type: 'string'
          }
          {
            name: 'DvcScopeId'
            type: 'string'
          }
          {
            name: 'DvcScope'
            type: 'string'
          }
          {
            name: 'AdditionalFields'
            type: 'dynamic'
          }
          {
            name: 'SrcIpAddr'
            type: 'string'
          }
          {
            name: 'SrcPortNumber'
            type: 'int'
          }
          {
            name: 'SrcHostname'
            type: 'string'
          }
          {
            name: 'SrcDomain'
            type: 'string'
          }
          {
            name: 'SrcDomainType'
            type: 'string'
          }
          {
            name: 'SrcFQDN'
            type: 'string'
          }
          {
            name: 'SrcDescription'
            type: 'string'
          }
          {
            name: 'SrcDvcId'
            type: 'string'
          }
          {
            name: 'SrcDvcIdType'
            type: 'string'
          }
          {
            name: 'SrcDvcScopeId'
            type: 'string'
          }
          {
            name: 'SrcDvcScope'
            type: 'string'
          }
          {
            name: 'SrcDeviceType'
            type: 'string'
          }
          {
            name: 'SrcGeoCountry'
            type: 'string'
          }
          {
            name: 'SrcGeoLatitude'
            type: 'string'
          }
          {
            name: 'SrcGeoLongitude'
            type: 'string'
          }
          {
            name: 'SrcGeoRegion'
            type: 'string'
          }
          {
            name: 'SrcGeoCity'
            type: 'string'
          }
          {
            name: 'SrcRiskLevel'
            type: 'int'
          }
          {
            name: 'SrcOriginalRiskLevel'
            type: 'string'
          }
          {
            name: 'SrcMacAddr'
            type: 'string'
          }
          {
            name: 'DhcpCircuitId'
            type: 'string'
          }
          {
            name: 'DhcpLeaseDuration'
            type: 'int'
          }
          {
            name: 'DhcpSessionDuration'
            type: 'int'
          }
          {
            name: 'DhcpSessionId'
            type: 'string'
          }
          {
            name: 'DhcpSrcDHCId'
            type: 'string'
          }
          {
            name: 'DhcpSubscriberId'
            type: 'string'
          }
          {
            name: 'DhcpUserClass'
            type: 'string'
          }
          {
            name: 'DhcpUserClassId'
            type: 'string'
          }
          {
            name: 'DhcpVendorClass'
            type: 'string'
          }
          {
            name: 'DhcpVendorClassId'
            type: 'string'
          }
          {
            name: 'RequestedIpAddr'
            type: 'string'
          }
          {
            name: 'SrcOriginalUserType'
            type: 'string'
          }
          {
            name: 'SrcUserId'
            type: 'string'
          }
          {
            name: 'SrcUserIdType'
            type: 'string'
          }
          {
            name: 'SrcUsername'
            type: 'string'
          }
          {
            name: 'SrcUsernameType'
            type: 'string'
          }
          {
            name: 'SrcUserScope'
            type: 'string'
          }
          {
            name: 'SrcUserScopeId'
            type: 'string'
          }
          {
            name: 'SrcUserSessionId'
            type: 'string'
          }
          {
            name: 'SrcUserType'
            type: 'string'
          }
          {
            name: 'SrcUserUid'
            type: 'string'
          }
          {
            name: 'EventSchema'
            type: 'string'
          }
        ]
    }
    destinations: {
      logAnalytics: [
        {
          workspaceResourceId: workspaceResourceId
          name: 'vmetric-datastream'
        }
      ]
    }
    dataFlows: [
      {
        streams: [
          'Custom-ASimAuditEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimAuditEventLogs'
      }
      {
        streams: [
          'Custom-ASimAuthenticationEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimAuthenticationEventLogs'
      }
      {
        streams: [
          'Custom-ASimDhcpEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimDhcpEventLogs'
      }
      {
        streams: [
          'Custom-ASimDnsActivityLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimDnsActivityLogs'
      }
      {
        streams: [
          'Custom-ASimNetworkSessionLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimNetworkSessionLogs'
      }
      {
        streams: [
          'Custom-ASimFileEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimFileEventLogs'
      }
      {
        streams: [
          'Custom-ASimProcessEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimProcessEventLogs'
      }
      {
        streams: [
          'Custom-ASimRegistryEventLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimRegistryEventLogs'
      }
      {
        streams: [
          'Custom-ASimUserManagementActivityLogs'
        ]
        destinations: [
          'vmetric-datastream'
        ]
        transformKql: 'source'
        outputStream: 'Microsoft-ASimUserManagementActivityLogs'
      }
    ]
  }
}

output immutableId string = dataCollectionRule.properties.immutableId
```

Each Bicep template is thoroughly tested and maintained to support VirtualMetric's monitoring capabilities while following Microsoft's best practices for DCR deployment and management. The templates include modular components that can be customized to meet specific organizational requirements while maintaining consistent data collection standards.