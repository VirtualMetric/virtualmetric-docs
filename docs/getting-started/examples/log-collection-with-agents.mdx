---
pagination_next: null
---

# Example: Log Collection with Agents

## Synopsis

Learn how to deploy **Agent** endpoints for collecting Windows Event logs from remote computers and sending them to a centralized **Director** for processing. This example demonstrates basic Agent-Director coordination using websocket communication.

**What You'll Learn:**

- Deploy **Agent** on a **Windows** client machine
- Configure **Director** to receive **Agent** connections
- Collect Windows Event logs remotely
- Verify log collection is working

**Prerequisites:** **Director** running on a server
**Time Estimate:** 15 minutes
**Files Created:** 2 configuration files

## Scenario

You have a **Windows** server running **Director** and want to collect Windows Event logs from multiple **Windows** client machines across your network. Rather than installing **Director** on every machine, you deploy lightweight **Agent** endpoints that collect logs locally and send them to the centralized **Director**.

**Architecture:**

- **Director**: Server-side telemetry processor (receives and processes logs)
- **Agent**: Client-side log collector (collects Windows Events, sends to Director)
- **Communication**: Websocket connection from **Agent** to **Director**

## Setup

### Step 1: Configure Director for Agent Connections

Create a device configuration on your **Director** server to accept **Agent** connections.

```yaml title="<vm_root>/Director/config/devices/windows-agent-device.yml"
devices:
  1001:
    id: 1001
    type: "agent"
    name: "Windows Agent Collector"
    enabled: true
    properties:
      port: 8080
      bind: "0.0.0.0"
      device_id: "win-client-001"
      tls:
        enabled: false
```

### Step 2: Configure Agent on Windows Client

<Topic id="single-node-deployment-director">Deploy **Agent**</Topic> on the **Windows** client machine, and configure it to connect to **Director**.

```yaml title="<vm_root>/Agent/config/vmetric.yml"
director:
  host: "192.168.1.100"
  port: 8080
  device_id: "win-client-001"
  tls:
    enabled: false

collector:
  windows_events:
    enabled: true
    channels:
      - "Security"
    event_ids:
      - 4624  # Successful logon
      - 4625  # Failed logon
      - 4648  # Logon using explicit credentials
    batch_size: 100
    interval: "5s"
```

### Step 3: Start Services

On **Director**'s machine:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    vmetric-director
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    vmetric-director
    ```
  </TabItem>
</Tabs>

On the client machine:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    vmetric-agent
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    vmetric-agent
    ```
  </TabItem>
</Tabs>

## Trial

### Verify Agent Connection

Check **Director** logs for **Agent** connection:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
  On **Director**'s machine:
    
  ```powershell
  Get-Content -Path <vm_root>\Director\storage\logs\director.log -Tail 10 -Wait
  ```
  </TabItem>
  <TabItem value="bash" label="Bash">
  On **Director**'s machine:

  ```bash
  tail -f <vm_root>/Director/storage/logs/director.log
  ```
  </TabItem>
</Tabs>

Expected output:

```
[INFO] Agent device win-client-001 connected via websocket
[INFO] Device 1001 (Windows Agent Collector) activated
[INFO] Windows Event collector started for Security channel
```

### Verify Event Collection

Generate **Windows** login events on the client machine (login/logout) and check if they appear in **Director**'s processing queue:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
  On **Director**'s machine:
  
  ```powershell
  Get-ChildItem <vm_root>\Director\storage\queue\
  ```
  </TabItem>
  <TabItem value="bash" label="Bash">
  On **Director**'s machine:

  ```bash
  ls <vm_root>/Directorstorage/queue/
  ```
  </TabItem>
</Tabs>

You should see queue files containing collected _Windows Event logs_.

## Monitoring

### Agent Status

Check **Agent** connection status:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
  On client:

  ```powershell
  vmetric-agent -status
  ```
  </TabItem>
  <TabItem value="bash" label="Bash">
  On client:

  ```bash
  vmetric-agent -status
  ```
  </TabItem>
</Tabs>

Expected output:
```
Agent Status: Connected
Director: 192.168.1.100:8080
Device ID: win-client-001
Websocket: Active
Events Collected: 47
Last Collection: 2025-01-19 14:30:15
```

### Director Device Status

Verify the device is receiving data:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
  On **Director**'s machine
  
  ```powershell
  vmetric-director -device -status 1001
  ```
  </TabItem>
  <TabItem value="bash" label="Bash">
  On **Director**'s machine
  
  ```bash
  vmetric-director -device -status 1001
  ```
  </TabItem>
</Tabs>

Expected output:

```
Device 1001: Active
Name: Windows Agent Collector
Type: agent
Connection: websocket
Events Received: 47
Last Activity: 2025-01-19 14:30:15
```

### Event Log Verification

Check specific event IDs are being collected by examining a queue file:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
  On **Director**'s machine (example file):
  
  ```powershell
  vmetric-director -debug -queue Director\storage\queue\eventlog\queue.*.vmfl
  ```
  </TabItem>
  <TabItem value="bash" label="Bash">
  On **Director**'s machine (example file):

  ```bash
  vmetric-director -debug -queue storage/queue/eventlog/queue.*.vmfl
  ```
  </TabItem>
</Tabs>

You should see _Windows Event_ entries with Event IDs `4624`, `4625`, and `4648` in VMFL binary format.
