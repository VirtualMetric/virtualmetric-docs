---
pagination_next: null
---


# Example: Service Management with Supervisor

This section will help you configure and run the **VirtualMetric Agent** in supervisor mode to manage DataStream services while maintaining system availability.

## Synopsis

We will configure the **Agent** in supervisor mode to monitor and manage **Director** and other **Agent** services automatically. This demonstrates the service watchdog capability that ensures DataStream components remain operational.

## Scenario

We will implement the following service management setup:

- **Enable Supervisor Mode** - Run **Agent** in supervisor mode to monitor other DataStream services.

- **Configure monitoring** - Set up **Agent** supervisor mode to watch **Director** and other **Agent** services.

- **Service management** - Automatically restart failed services to maintain system availability.

- **Health monitoring** - Continuously check service status and respond to failures.

We assume you have **Director** and **Agent** services installed and running. The **Agent** in supervisor mode will need appropriate permissions to manage system services.

## Setup and Trial

<Include id="important-config-files" />

For this example, we will create a configuration file named `vmetric.yml` in the Agent's working directory.

### Step 1: Install Required Services

First, ensure you have **Director** and **Agent** services installed on your system:

```powershell
.\vmetric-director -service=install
.\vmetric-agent -service=install
```

### Step 2: Configure Supervisor

Create a `vmetric.yml` configuration file for the **Agent** supervisor mode:

```yaml title="vmetric.yml"
supervisor:
  enabled: true
  services:
    - name: "vmetric-director"
      auto_restart: true
      restart_delay: 5
    - name: "vmetric-agent"
      auto_restart: true
      restart_delay: 5
  check_interval: 60
```

This configuration will:

- Enable `supervisor.enabled: true` to activate service monitoring
- Define `services` list with **Director** and **Agent** services to monitor
- Configure `auto_restart: true` to automatically restart failed services
- Set `restart_delay: 5` seconds before attempting service restart
- Use `check_interval: 60` seconds for service health checks

### Step 3: Start Agent in Supervisor Mode

Once the **Agent** service is installed and running, you can enable supervisor mode to begin monitoring other DataStream services:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-agent -supervisor
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-agent -supervisor
    ```
  </TabItem>
</Tabs>

**Agent** in supervisor mode will:

- Read the `vmetric.yml` configuration file
- Begin monitoring the status of **Director** and **Agent** services
- Automatically restart any failed services according to the configuration
- Log service management activities for monitoring
- Maintain continuous health checks on managed services

### Step 4: Verify Supervisor Operation

Check the **Agent** supervisor mode logs to confirm it's monitoring the other services:

```console
[2025-01-15 10:45:20] [Information] [vmetric-agent] Supervisor mode started successfully
[2025-01-15 10:45:21] [Information] [vmetric-agent] Starting health check for service: vmetric-director
[2025-01-15 10:45:21] [Information] [vmetric-agent] Starting health check for service: vmetric-agent
[2025-01-15 10:45:22] [Information] [vmetric-agent] All supervised services are running normally
```

<Include id="info-update-config-live" />

## Monitoring

Check the **Agent** supervisor mode logs to verify successful service management:

- **Service status logs** - Confirm **Agent** supervisor mode is monitoring **Director** and other **Agent** services
- **Health check logs** - Verify periodic service health checks are occurring
- **Restart logs** - Check for any automatic service restarts when failures occur
- **Error logs** - Monitor for any service management issues or failures

If **Agent** supervisor mode is running correctly, you should see periodic health check messages indicating that it's actively monitoring the DataStream services and will restart them automatically if they fail.
