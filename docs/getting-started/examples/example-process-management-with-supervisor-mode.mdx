---
pagination_next: null
---

import ImportantConfigFiles from '../../assets/reusable/examples/important-config-files.mdx';
import InfoUpdateConfigLive from '../../assets/reusable/examples/info-update-config-live.mdx';

# Example: Service Management with Supervisor

This section will help you configure and run the **VirtualMetric Supervisor** to manage DataStream services while maintaining system availability.

## Synopsis

We will configure the **Supervisor** service to monitor and manage **Director** and **Agent** services automatically. This demonstrates the service watchdog capability that ensures DataStream components remain operational.

## Scenario

We will implement the following service management setup:

- **Install Supervisor** - Deploy **Supervisor** service to monitor other DataStream services.

- **Configure monitoring** - Set up **Supervisor** to watch **Director** and **Agent** services.

- **Service management** - Automatically restart failed services to maintain system availability.

- **Health monitoring** - Continuously check service status and respond to failures.

We assume you have **Director** and **Agent** services installed. **Supervisor** will need appropriate permissions to manage system services.

## Setup and Trial

<ImportantConfigFiles />

For this example, we will create a configuration file named `vmetric.yml` in the Supervisor's working directory.

### Step 1: Install Required Services

First, ensure you have **Director** and **Agent** services installed on your system:

```powershell title="Install Director Service"
.\vmetric-director -service=install
```

```powershell title="Install Agent Service"
.\vmetric-agent -service=install
```

### Step 2: Configure Supervisor

Create a `vmetric.yml` configuration file for the **Supervisor** service:

```yaml title="vmetric.yml"
supervisor:
  enabled: true
  services:
    - name: "vmetric-director"
      auto_restart: true
      restart_delay: 5
    - name: "vmetric-agent"
      auto_restart: true
      restart_delay: 5
  check_interval: 60
```

This configuration will:

- Enable `supervisor.enabled: true` to activate service monitoring
- Define `services` list with **Director** and **Agent** services to monitor
- Configure `auto_restart: true` to automatically restart failed services
- Set `restart_delay: 5` seconds before attempting service restart
- Use `check_interval: 60` seconds for service health checks

### Step 3: Install Supervisor Service

Install the **Supervisor** service to run as a system service:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-supervisor -service=install
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-supervisor -service=install
    ```
  </TabItem>
</Tabs>

### Step 4: Start Supervisor Service

Launch the **Supervisor** service to begin monitoring other DataStream services:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-supervisor -service=start
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-supervisor -service=start
    ```
  </TabItem>
</Tabs>

**Supervisor** will:

- Read the `vmetric.yml` configuration file
- Begin monitoring the status of **Director** and **Agent** services
- Automatically restart any failed services according to the configuration
- Log service management activities for monitoring
- Maintain continuous health checks on managed services

### Step 5: Verify Supervisor Operation

Check the **Supervisor** service logs to confirm it's monitoring the other services:

```console
[2025-01-15 10:45:20] [Information] [vmetric-supervisor] Supervisor service started successfully
[2025-01-15 10:45:21] [Information] [vmetric-supervisor] Starting health check for service: vmetric-director
[2025-01-15 10:45:21] [Information] [vmetric-supervisor] Starting health check for service: vmetric-agent
[2025-01-15 10:45:22] [Information] [vmetric-supervisor] All supervised services are running normally
```

<InfoUpdateConfigLive />

## Monitoring

Check the **Supervisor** service logs to verify successful service management:

- **Service status logs** - Confirm **Supervisor** is monitoring **Director** and **Agent** services
- **Health check logs** - Verify periodic service health checks are occurring
- **Restart logs** - Check for any automatic service restarts when failures occur
- **Error logs** - Monitor for any service management issues or failures

If **Supervisor** is running correctly, you should see periodic health check messages indicating that it's actively monitoring the DataStream services and will restart them automatically if they fail.
