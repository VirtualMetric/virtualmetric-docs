---
pagination_next: null
---

import ImportantConfigFiles from '../../assets/reusable/examples/important-config-files.mdx';
import InfoUpdateConfigLive from '../../assets/reusable/examples/info-update-config-live.mdx';

# Example: Centralized Log Collection with Agent

This section will help you configure and run a **VirtualMetric Agent** to collect logs from remote systems and send them to a **Director** for processing.

## Synopsis

We will configure an **Agent** to connect to a **Director** and automatically collect log data from a remote server. This demonstrates the core distributed log collection capability that allows centralized data ingestion from multiple systems.

## Scenario

We will implement the following log collection setup:

- **Install Agent** - Deploy **Agent** service on a remote system that generates logs.

- **Configure connection** - Set up secure communication between **Agent** and **Director**.

- **Collect logs** - Automatically gather log data using predefined collection definitions.

- **Send data** - Transmit collected logs to **Director** for processing and forwarding.

We assume you have a **Director** instance running and accessible from **Agent**'s system. **Agent** will need network connectivity to reach **Director**'s service endpoint.

## Setup and Trial

<ImportantConfigFiles />

For this example, we will create a simple configuration file named `vmetric.yml` in the Agent's working directory.

### Step 1: Configure Director

First, add a device configuration to your **Director**'s configuration file to define the **Agent**:

```yaml title="director-config.yml"
devices:
  - id: 1
    name: production_server
    type: windows
    status: true
    properties:
      type: agent 
    definitions:
      - name: windows_event_log_collector
      - name: windows_security_log_collector
```

This configuration will:

- Create a device entry with `id: 1` for **Agent** to connect to
- Set the device `type: windows` to indicate the target operating system
- Enable the device with `status: true` to allow data collection
- Configure `type: agent` in properties to specify this is an **Agent**-based device
- Include two predefined **Windows** log collection `definitions`:
  - `windows_event_log_collector`: Base Windows event log collection
  - `windows_security_log_collector`: Windows security log collection (includes Security events, AppLocker events)

:::info Agent Definition IDs
For complete details on predefined Agent definition IDs and security event collections, see <Topic id="appendix-agent-ids">Appendix</Topic>.
:::

### Step 2: Configure Agent

On the system where you want to collect logs, create a `vmetric.yml` configuration file:

```yaml title="vmetric.yml"
device:
  id: 1
director:
  address: 192.168.1.200:8080
```

This configuration will:

- Set `device.id: 1` to match the device ID configured in **Director**
- Specify `director.address` as the IP address and port where Director is listening
- Use port `8080` which is **Director**'s default service port

### Step 3: Start Director

Launch **Director** in console mode to monitor the connection:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-director -console
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-director -console
    ```
  </TabItem>
</Tabs>

You should see **Director** start up and begin listening for **Agent** connections.

### Step 4: Start Agent

On the remote system, launch **Agent**:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-agent
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-agent
    ```
  </TabItem>
</Tabs>

**Agent** will:

- Read the `vmetric.yml` configuration file
- Connect to **Director** at the specified address
- Begin collecting log data based on the configured definitions
- Send collected logs to **Director** for processing

### Step 5: Verify the connection

In **Director**'s console, you should see messages indicating successful **Agent** connection and log collection:

```console
[2025-01-15 10:30:15] [Information] [vmetric-director] Agent connection established for device: production_server
[2025-01-15 10:30:16] [Information] [vmetric-director] Processing logs from device ID: 1
[2025-01-15 10:30:16] [Information] [vmetric-director] Completed processing of agent logs. Number of processed events: 2
```

<InfoUpdateConfigLive />

## Monitoring

Check the **Director**'s logs to verify successful log collection:

- **Connection logs** - Confirm **Agent** successfully connected to **Director**
- **Event logs** - Verify log data is being collected and processed
- **Error logs** - Check for any connection or configuration issues

If **Agent** is running correctly, you should see periodic log collection messages in the **Director** console, indicating the distributed log collection system is operational.
