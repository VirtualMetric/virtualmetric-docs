import ImportantConfigFiles from '../../assets/reusable/examples/important-config-files.mdx';
import AttentionCountForGenerator from '../../assets/reusable/examples/caution-count-for-generator.mdx';
import InfoComponentEnablement from '../../assets/reusable/examples/info-component-enablement.mdx';

# Example: Ingesting Data

This section will help you get started with devices to ingest data with specific protocols, walking you through a common use case.

:::info
For a detailed discussion of devices, see <Topic id="devices-overview-config">this section</Topic>.
:::

## Scenario

Use **UDP** as the listening protocol.

## Setup and Trial

<ImportantConfigFiles />

We will create a device that will receive data from _Syslog_ using an insecure **UDP** connection.

### Step 1. Create the device configuration

Create a file named `from-syslog-udp.yml` in our working directory, and then open it with a text editor to enter the following:

```yaml title="from-syslog-udp.yml"
devices:
  - id: 1
    name: from_syslog_udp
    type: syslog
    status: true
    properties:
      protocol: udp
      address: 127.0.0.1
      port: 514
```

This YAML code specifies that this is a _Syslog_ device, that it will use UDP as its protocol, and that it will be listening on port `514`. You can enter any integer as the `id` value.

<InfoComponentEnablement />

However, we also need to define a target that the ingested data willl be directed to, and a route combining the device and the target.

Create a file named `to-console.yml` and add the following target definition to it:

```yaml title="to-console.yml"
targets:
  - name: to_console
    status: true
    type: console
```

Now create a file named `syslog-to-console.yml` and add the following route definition to it.

```yaml title="syslog-to-console.yml"
routes:
  - name: syslog_to_console
    devices:
      - name: from_syslog_udp
    targets:
      - name: to_console
```

:::info
To see the ingested data, your must _route_ the stream to a specific destination! For a detailed discussion of Routes, see <Topic id="routes-config">this section</Topic>.
:::

We are now ready to try our configuration.

### Step 2. Run the UDP device

Open a terminal and enter the following in the command line to start **Director**:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-director -background
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-director -background
    ```
  </TabItem>
</Tabs>

This will start **Director** as a background process which you can verify as <Topic id="single-node-director-post">indicated before</Topic>. Now enter:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    .\vmetric-director -console
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    ./vmetric-director -console
    ```
  </TabItem>
</Tabs>

The `-console` switch will print status messages to the terminal.

After you press <kb-short>Enter</kb-short>, you will see a stream of initialization messages and our device will be spawned off, waiting to receive _Syslog_ messages.

### Step 3. Run the configuration

We can now run the reception using **Director**'s cross-platform generator mode.

Open a new terminal and enter the following in the command line:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    - Using generator mode

    ```powershell
    .\vmetric-director -generator -now -mode syslog -count 1 -address "127.0.0.1:514" -message="Hello world"
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    - Using generator mode
  
    ```bash
    ./vmetric-director -generator -now -mode syslog -count 1 -address "127.0.0.1:514" -message="Hello world"
    ```
    
    - Using **System Logger**

    ```bash
    logger -n 127.0.0.1 -P 514 "Hello world"
    ```
  </TabItem>
</Tabs>

<AttentionCountForGenerator />

If you are using the generator mode, after you press <kb-short>Enter</kb-short> the program will start sending our message, one at a time, to _Syslog_. It will signal that it sent the message with a prompt like this:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    1 message sent successfully in 11 ms with 0 error(s) at 2025-06-02 01:54:02.0349011 +0300 +03 m=+2.821324601
    2 messages sent successfully since 2025-06-02 01:54:00 +0300 +03
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    1 message sent successfully in 11 ms with 0 error(s) at 2025-06-02 01:54:02.0349011 +0300 +03 m=+2.821324601
    2 messages sent successfully since 2025-06-02 01:54:00 +0300 +03
    ```
  </TabItem>
</Tabs>

After sending a limited number of messages&mdash;say 5 of them&mdash;press <kb-short>Ctrl+C</kb-short> to exit the process.

If you now switch back to **Director**'s terminal, you will see each sent message (i.e. "Hello world") as received on the console:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```powershell
    <1> 2025-06-02T08:33:28+03:00 VirtualMetric Test[3872]: Hello world
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    <1> 2025-06-02T08:33:28+03:00 VirtualMetric Test[3872]: Hello world
    ```
  </TabItem>
</Tabs>

## Monitoring

Check **Director**'s logs&mdash;the files in the directory indicated <Topic id="examples-logging-setup">here</Topic>&mdash;for any error messages. If there were no errors, it should be blank.

---

In the next section, we will create a secure _device_ to ingest the data.
