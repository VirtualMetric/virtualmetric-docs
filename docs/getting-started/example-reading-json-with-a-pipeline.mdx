import Link from '@docusaurus/Link';

# Example: A Syslog-To-Parquet Pipeline

This section will help you get started with configuring and running a very simple pipeline, walking you through a common use case.

:::tip
For a detailed discussion, see [this section](../configuration/pipelines/overview.mdx#configuration).
:::

## Scenario

To understand how a pipeline works at the very basic level, we will create a very simple input file in JSON format and a very simple pipeline that does only one transformation, and using **Director**'s pipeline validation and testing facilities, we will see the pipeline in action.

## Sample Case

:::tip
For the following, nagivate to `<vm_root>` in your terminal, and continue working there since any paths given will be relative.
:::

## Step 1: Create Test Data

First, create a JSON file named `sample-data.json` in our working directory, and put the following sample data in it:

```json
{
  "words": ["hello", "world"]
}
```

## Step 2: Define Pipeline Logic

Then, create a YAML file in our working directory named `convert-words.yml`, and put the following pipeline definition in it:

```yaml
pipelines:
  - name: convert_words
pipelines:
  - name: convert_words
      processors:
        - uppercase:
            field: words
            target_field: convertedWords
```

:::tip
When configuring a pipeline, we use the identifiers in the `name` fields of the components.
:::

:::warning
The YAML formatting of pipelines requires that all entries after `- name:` is indented one tab.
:::

Here is what this pipeline will do:

- Look for the field named `words` in the JSON file we will feed it.
- Using the `json` processor's `add_to_root` flag, copy the values it has spotted in that field to the root of the output document.
- Using the [`foreach`](../configuration/pipelines/processors/foreach.mdx) processor&mdash;which applies its specified `processor` (here, [`uppercase`](../configuration/pipelines/processors/uppercase.mdx)) to each element in the list returned by the meta field `"_ingest._value"`&mdash;convert each item to uppercase.

## Step 3: Validate The Pipeline

To see whether our pipeline is valid, we enter the following command in the terminal:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    vmetric-director -validate -path=".\config\Examples\convert-words.yml"
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    vmetric-director -validate -path="./config/Examples/convert-words.yml"    vmetric-director -validate -path="./config/Examples/convert-words.yml
    ```
  </TabItem>
</Tabs>

If our pipeline is valid, this command will return:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    [OK] No issues found.
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    [OK] No issues found.
    ```
  </TabItem>
</Tabs>

Since that is indeed the case, we can now run our test.

## Step 4: Test The Pipeline

To see our pipeline in action, enter the following in the terminal:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    vmetric-director -mode pipeline -path=".\config\Examples\convert-words.yml" -name convert_words -input ".\config\Examples\sample-data.json" -output ".\config\Examples\processed-sample-data.json"
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    vmetric-director -mode pipeline -path="./config/Examples/convert-words.yml" -name convert_words -input "./config/Examples/sample-data.json" -output "./config/Examples/processed-sample-data.json"
    ```
  </TabItem>
</Tabs>

Here is what this test will do:

* Consume the data in the input file named `sample-data.json` that we put in our working directory
* Using the pipeline we named `convert_words`, convert the words in the `words` field to `uppercase`
* Write the converted names to a new field named `convertedWords`
* Save the results to an output file named `processed-sample-data.json` in our working directory.

:::note
The output file should be created when the test is run.
:::

## Step 5: Check The Processed Data

Now open the file named `processed-sample-data.json` to see the results. It should appear like this:

```json
{
  "convertedWords": ["HELLO", "WORLD"]
}
```

Now we can proceed to creating our data flow design.

<Link to="./introduction#examples" className="button button--primary">Back To Examples</Link>
