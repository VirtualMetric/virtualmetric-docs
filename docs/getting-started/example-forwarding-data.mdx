import Link from '@docusaurus/Link';

# Example: Forwarding Data

This section will help you get started with targets to write processed data to specific formats, walking you through common use cases.

:::tip
For a detailed discussion, see [this section](../configuration/targets/overview.mdx#configuration).
:::

## Scenarios

In this section, we will send the data we receive from _Syslog_ to these destinations:

* **Console**: the data will be sent to the console first raw, then normalized to ECS
* **Storage File**: the data will be converted to the JSON storage format

## Console Setup

The most basic target to which we can direct our output is a _console_. In the previous section, to have the _syslog_ data we have ingested&mdash;using the device we have configured there&mdash;directed to the console, we created a route like so:

```yaml
routes:
  - name: syslog_to_console
    devices:
      - name: from_syslog
    targets:
      - name: to_console
```

Assume, however, that we want to customize the stream directed to the console. For that purpose, we will modify the target configuration in our `to-console.yml` file (placed in our [working directory](./introduction.mdx#working-directory)) as:

```yaml title="to-console.yml"
targets:
  - name: to_console
    type: console
    properties:
      format: "ecs"
```

With this setting, we will normalize our data to the [ECS](../appendix.mdx#ecs) format.

To see the results on the console, once again go to the terminal you are using for **Director** invoke it by entering:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    vmetric-director
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    metric-director
    ```
  </TabItem>
</Tabs>

Then, once again, go to the other terminal you are using for **Generator** (or other traditional message sending OS tool), and start sending our familiar message:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    - Using **Generator**

    ```powershell
    vmetric-generator -mode=syslog -address="127.0.0.1:514" -message="Hello world"
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    - Using **Generator**
  
    ```bash
    vmetric-generator -mode=syslog -address="127.0.0.1:514" -message="Hello world"
    ```
    
    - Using **System Logger**

    ```bash
    logger -n 127.0.0.1 -P 514 "Hello world"
    ```
  </TabItem>
</Tabs>

This time, you will see that our message is printed to the console in ECS format we have specified:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    ```PowerShell
    {"message":"<3> 2025-06-02T10:38:02+03:00 VirtualMetric Test[7916]: Hello world","@timestamp":"2025-06-02T10:38:02+03:00"}
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    {"message":"<3> 2025-06-02T10:38:02+03:00 VirtualMetric Test[7916]: Hello world","@timestamp":"2025-06-02T10:38:02+03:00"}
    ```
  </TabItem>
</Tabs>

Once again, you can exit either process by pressing <kb-short>Ctrl+C</kb-short>.

## Storage File Setup

The next type of output we can use is a file. Various formats are available in **DataStream**, but for the sake of simplicity, we will pick the widely used _JSON_ format which is the default for the `file` target type:

```yaml
targets:
  - name: to_json
    type: file
    properties:
      location: "<vm_root>/config/Examples"
      name: "from_syslog_{{.Year}}_{{.Month}}_{{.Day}}.json"
```

Create a file named `to-json.yml` in our working directory and save this code in it.

The path we have specified for `location` is where the JSON file will be created. (Do not forget to replace `<vm_root>` with the actual path of your **VirtualMetric** installation.) The nested `name` parameter is for the file: it will have a `from_syslog_` prefix to which the internal field values of `Year`, `Month`, and `Day` will be appended.

:::note
Under `properties`, we did not specify any `format` since JSON is the default for the file target type.
:::

To be able to use this target, we have to configure another route. To keep things simple, first open the `syslog-to-console.yml` and comment out the route definition in it, and save:

```yaml title="syslog-to-console.yml"
# routes:
#   - name: syslog_to_console
#     devices:
#       - name: from_syslog
#     targets:
#       - name: to_console
```

:::note
**VirtualMetric Director** runs all the defined routes it has spotted under the `config` directory simultaneously.
:::

Now create a file named `syslog-to-json.yml` and place this new route definition in it:

```yaml title="syslog-to-json.yml"
routes:
  - name: syslog_to_json
    devices:
      - name: from_syslog
    targets:
      - name: to_json
```

Once again, run **Generator** or equivalent to send messages to syslog:

<Tabs>
  <TabItem value="powershell" label="PowerShell" default>
    - Using **Generator**

    ```powershell
    vmetric-generator -mode=syslog -address="127.0.0.1:514" -message="Hello world"
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    - Using **Generator**
  
    ```bash
    vmetric-generator -mode=syslog -address="127.0.0.1:514" -message="Hello world"
    ```
    
    - Using **System Logger**

    ```bash
    logger -n 127.0.0.1 -P 514 "Hello world"
    ```
  </TabItem>
</Tabs>

To have this _syslog_ message directed to the storage file we have configured, invoke **Director** from your terminal:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    vmetric-director
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    vmetric-director
    ```
  </TabItem>
</Tabs>

**Director** will issue prompts like the following while it is writing the ingested data to our JSON file:

<Tabs>
  <TabItem value="powershell" label="PowerShell">
    ```PowerShell
    [2025-06-02 11:15:58] [Information] [vmetric-director] Completed processing of to_json target logs. Number of processed logs: 1000
    ```
  </TabItem>
  <TabItem value="bash" label="Bash">
    ```bash
    [2025-06-02 11:15:58] [Information] [vmetric-director] Completed processing of to_json target logs. Number of processed logs: 1000
    ```
  </TabItem>
</Tabs>

Press <kb-short>Ctrl+C</kb-short> in both terminals to exit the processes.

Now we can check our output. In our working directory, you will find a file with a name like `from_syslog_2025_06_02.json`. Open it with a text editor. You will find that the ingested data has been stored in it in a format like this:

```json
{"epoch":1748852145,"message":"<3> 2025-06-02T11:15:45+03:00 VirtualMetric Test[5832]: Hello world"}
```

Since we have only sent the same message multiple times, there will be multiple copies of it in the file.

---

In the next section, we will learn how **Director** combines _devices_ and _targets_ using _routes_.

<Link to="./introduction#examples" className="button button--primary">Back To Examples</Link>
