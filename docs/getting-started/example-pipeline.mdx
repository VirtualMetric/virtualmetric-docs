---
pagination_next: null
---

# Example: A Syslog-To-Sentinel Data Pipeline

This chapter will help you get started with configuring and running a pipeline, walking you through a common scenario.

:::note
For a general discussion, see our [overview](/docs/configuration/pipelines/index.mdx) chapter.
:::

## Overview

We will create a pipeline that ingests logs from a _Syslog_ source, processes them, and forwards them to **Microsoft Sentinel** in _Advanced Security Information Model_ (ASIM) format.

## Prerequisites

To achieve this goal, we must have an environment with access to _Syslog_ inputs. We also need a **Microsoft Sentinel** workspace with proper permissions.

Also, a basic understanding of the YAML format is necessary to create the configuration files.

For convenience, we will place all our files directly under `<vm_root>/config`.

:::note
You can place these files anywhere you wish since **Director** discovers them by iterating the folder tree. Pick the organization that best fits your needs.
:::

## Step 1: Configure The Device

First, we have to define a device to receive the log data. We will use the configuration we have created in our [device example](/docs/getting-started/example-device.mdx) as our starting point, modifying the settings to fit our needs here:

```yml
- id: 1
  name: syslog_tcp
  type: syslog
  properties:
    protocol: tcp
    port: 1514
    framing: delimiter
    line_delimiter: "\n"
    buffer_size: 16384
    batch_size: 1000
```

Put this in a file named `pipeline-device.yml` placed under `<vm_root>`.

This configuration will create a _TCP Syslog_ server listening on port `1514`. We have specfied the line feed character as the delimiter for message framing. We also set the appropriate buffer and batch sizes.

## Step 2: Configure The Target

Next, we will create a target for **Microsoft Sentinel** in a file named `pipeline-target.yml`:

```yml
- id: 1
  name: sentinel_asim
  description: "Microsoft Sentinel ASIM target"
  type: sentinel
  properties:
    tenant_id: "${AZURE_TENANT_ID}"
    client_id: "${AZURE_CLIENT_ID}"
    client_secret: "${AZURE_CLIENT_SECRET}"
    workspace_id: "${SENTINEL_WORKSPACE_ID}"
    format: asim
    batch_size: 100
    flush_interval: 60
```

With this configuration, we are setting up the authentication with **Azure** using environment variables. We have specified the target format as ASIM, and configured batching and flush intervals for optimal performance.

## Step 3: Create A Processing Pipeline

We are now ready to configure our pipeline. Create a file named `pipeline.yml` under the root, and put the following in it:

```yml
- id: 1
  name: syslog_to_sentinel
  description: "Process Syslog data for Microsoft Sentinel ASIM"
  processors:
    # Parse Syslog header information
    - grok:
        - field: message
        - patterns:
            - "%{SYSLOGBASE} %{GREEDYDATA:syslog.message}"
    
    # Extract authentication events
    - grok:
        - field: syslog.message
        - patterns:
            - "%{DATA:event.action} %{WORD:user.name} from %{IP:source.ip}"
        - ignore_failure: true
    
    # Set event metadata
    - set:
        - field: event.kind
        - value: event
    
    # Set event category based on program
    - script:
        - lang: golang
        - source: |
            package main
            
            func main() {
              if program, ok := logEntry["program"].(string); ok {
                switch program {
                case "sshd":
                  setField(logEntry, "event.category", []string{"authentication"})
                case "firewall":
                  setField(logEntry, "event.category", []string{"network"})
                default:
                  setField(logEntry, "event.category", []string{"process"})
                }
              }
            }
    
    # Map fields to ASIM schema
    - rename:
        - fields:
            - from: timestamp
              to: event.created
            - from: source.ip
              to: src.ip
            - from: user.name
              to: user.name_orig
    
    # Clean up temporary fields
    - remove:
        - field:
            - syslog.message
            - message
        - ignore_missing: true
```

This configuration will parse the _Syslog_ header information using the `grok` processor and will extract authentication event details. It will then set the common event metadata. Next, using a script, it will categorize the events based on `program`, and map the fields to the ASIM schema structure. Once done, it will clean up the temporary fields.

:::note
In order to avoid raising an exception, we chose to ignore the missing fields.
:::

## Step 4: Configure the Route

Finally, we have to create a route to connect our device to the pipeline and then to our target. Create a file named `pipeline-route.yml`:

```yml
- name: syslog_to_sentinel_route
  description: "Route Syslog data to Microsoft Sentinel ASIM"
  sources:
    - name: syslog_server
  pipeline: syslog_to_sentinel
  destinations:
    - name: sentinel_asim
```

This configuration will connect the _Syslog_ server as the source, apply the `syslog_to_sentinel` pipeline for processing the ingested data, and then send that processed data to the **Microsoft Sentinel** ASIM target we have specified.

## Monitoring

Let's put it all together. We have created a number of files to configure our pipeline, and at this point we should have them ready:

```
config/
├── pipeline.yml
├── pipeline-device.yml
├── pipeline-target.yml
└── pipeline-route.yml
```

We will now run our pipeline and see the results:

<Tabs groupId="os-options">
  <TabItem value="windows" label="Windows">
    ```PowerShell
    # CLI code for running the pipeline
    ```
  </TabItem>
  <TabItem value="linux" label="Linux">
    ```bash
    # CLI code for running the pipeline
    ```
  </TabItem>
  <TabItem value="macos" label="macOS">
    ```bash
    # CLI code for running the pipeline
    ```
  </TabItem>
</Tabs>

After we start **Director** with our configuration files, it should send test _Syslog_ messages to port **1514**. Check the logs for any errors, and verify in **Microsoft Sentinel** that data is being received in the ASIM format.

## Troubleshooting

If you encounter any issues, check the following:

* Syslog server should be receiving messages (network connectivity)
* **Microsoft Sentinel** credentials should be correct

Also, examine the processor logs for any failures in the pipeline, and ensure that the mapped fields match the ASIM schema requirements.

## Next Steps

Now that you have a basic pipeline running, consider:

- Adding more complex field mappings for specific log types
- Implementing additional processors for data enrichment
- Creating multiple pipelines for different _Syslog_ sources
- Configuring alerts or dashboards in **Microsoft Sentinel** based on your data

With these building blocks, you can create sophisticated log processing workflows tailored to your security monitoring needs.

{/* TODO: Review and update the configuration details if necessary. */}
