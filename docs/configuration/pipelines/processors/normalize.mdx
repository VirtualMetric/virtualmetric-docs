---
description: Converts field names between formats
sidebar_custom_props: 
  customIcon: ðŸ”¨
  customCategory: Data Manipulation
---

# Normalize

<span className="theme-doc-version-badge badge badge--primary">Transform</span>

## Synopsis

Converts log field names between different normalization formats (ECS, CIM, ASIM, CEF, LEEF, CSL, OCSF, UDM).

## Schema

```yaml {3}
- normalize:
    source_format: <string>
    target_format: <string>
    field: <ident>
    ignore_unmapped_fields: <boolean>
    ignore_rules: <boolean>
    use_json_parser: <boolean>
    description: <text>
    if: <script>
    ignore_failure: <boolean>
    on_failure: <processor[]>
    on_success: <processor[]>
    tag: <string>
```

## Configuration

|Field|Required|Default|Description|
|---|---|---|---|
|`source_format`|N|auto-detect|Source format (`ecs`, `cim`, `asim`, `cef`, `leef`, `csl`, `ocsf`, `udm`)|
|`target_format`|Y|-|Target format to convert to|
|`field`|N|-|Nested field containing the data to normalize|
|`ignore_unmapped_fields`|N|`false`|Skip fields without mappings in the target format|
|`ignore_rules`|N|`false`|Skip schema enforcement rules for the target format|
|`use_json_parser`|N|`false`|Parse the source field as JSON before normalization|
|`description`|N|-|Documentation note|
|`if`|N|-|Conditional expression|
|`ignore_failure`|N|`false`|Skip processing errors|
|`on_failure`|N|-|Error handling processors|
|`on_success`|N|-|Success handling processors|
|`tag`|N|-|Identifier for logging|

## Details

The processor automatically detects source formats when not specified and handles field name transformations while preserving values. Format detection is case-insensitive.

### Supported Formats

| Format | Description |
|-------:|:------------|
| `ecs` | Elastic Common Schema |
| `cim` | Splunk Common Information Model |
| `asim` | Microsoft Sentinel ASIM |
| `cef` | Common Event Format |
| `leef` | Log Event Extended Format |
| `csl` | Common Schema Log |
| `ocsf` | Open Cybersecurity Schema Framework |
| `udm` | Google SecOps Unified Data Model |

### Schema Enforcement

When converting to UDM or OCSF, the processor applies schema enforcement rules by default. These rules normalize timestamps to microseconds, validate event types, normalize security actions, and ensure field values conform to the target schema specification. Set `ignore_rules: true` to skip enforcement.

### Field Mappings

The processor automatically detects the source format based on characteristic fields. Common mappings between formats:

<table>
  <tr><th></th><th>ECS</th><th>CIM</th><th>ASIM</th><th>UDM</th></tr>

  <tr><td rowSpan={"4"}>**Network**</td></tr>
  <tr><td>`source.ip`</td><td>`src`</td><td>`SrcIp`</td><td>`principal.ip`</td></tr>
  <tr><td>`destination.ip`</td><td>`dest`</td><td>`DstIp`</td><td>`target.ip`</td></tr>
  <tr><td>`network.direction`</td><td>`direction`</td><td>`NetworkDirection`</td><td>`network.direction`</td></tr>

  <tr><td rowSpan={"4"}>**Event**</td></tr>
  <tr><td>`@timestamp`</td><td>`_time`</td><td>`TimeGenerated`</td><td>`metadata.event_timestamp`</td></tr>
  <tr><td>`event.action`</td><td>`action`</td><td>`EventType`</td><td>`metadata.product_event_type`</td></tr>
  <tr><td>`event.severity`</td><td>`severity`</td><td>`EventSeverity`</td><td>`security_result.severity`</td></tr>

  <tr><td rowSpan={"4"}>**User**</td></tr>
  <tr><td>`source.user.name`</td><td>`user`</td><td>`ActorUsername`</td><td>`principal.user.userid`</td></tr>
  <tr><td>`source.user.id`</td><td>`user_id`</td><td>`ActorUserId`</td><td>`principal.user.windows_sid`</td></tr>
  <tr><td>`source.user.email`</td><td>`user_email`</td><td>`ActorUserEmail`</td><td>`principal.user.email_addresses`</td></tr>
</table>

See **Appendix** sections <Topic id="appendix-cim">**CIM**</Topic> and <Topic id="appendix-ecs">**ECS**</Topic> for details.

:::warning
Field mapping is non-reversible if the targeted format doesn't have equivalent fields. Test the conversions beforehand with sample data.
:::

## Examples

### ECS to CIM

<ExampleGrid>
  <CommentCol>
    ECS fields...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source": {
        "ip": "128.232.110.120"
      },
      "destination": {
        "ip": "192.168.1.1"
      },
      "network": {
        "direction": "inbound"
      }
    }
    ```
    ```yaml
    - normalize:
        source_format: ecs
        target_format: cim
    ```
  </CodeCol>
  <CommentCol>
    are mapped to CIM fields:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "src": "128.232.110.120",
      "dest": "192.168.1.1",
      "direction": "inbound"
    }
    ```
  </CodeCol>
</ExampleGrid>

### CIM to ECS

<ExampleGrid>
  <CommentCol>
    CIM fields...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "src": "128.232.110.120",
      "dest": "192.168.1.1",
      "direction": "outbound"
    }
    ```
    ```yaml
    - normalize:
        source_format: cim
        target_format: ecs
    ```
  </CodeCol>
  <CommentCol>
    are mapped to ECS fields:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source": {
        "ip": "128.232.110.120"
      },
      "destination": {
        "ip": "192.168.1.1"
      },
      "network": {
        "direction": "outbound"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### Auto-detection

<ExampleGrid>
  <CommentCol>
    Auto-detection discovers CIM...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "_time": "2023-01-01T00:00:00Z",
      "src": "128.232.110.120",
      "dest": "192.168.1.1",
      "direction": "outbound"
    }
    ```
    ```yaml
    - normalize:
        target_format: asim
    ```
  </CodeCol>
  <CommentCol>
    and maps the fields to ASIM:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "TimeGenerated": "2023-01-01T00:00:00Z",
      "SrcIp": "128.232.110.120",
      "DstIp": "192.168.1.1",
      "NetworkDirection": "outbound"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Error Handling

<ExampleGrid>
  <CommentCol>
    Handling conversion errors...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source": {
        "invalid": true
      }
    }
    ```
    ```yaml
    - normalize:
        target_format: cim
        ignore_failure: true
        on_failure:
          - set:
              field: error
              value: "Conversion failed"
    ```
  </CodeCol>
  <CommentCol>
    captures the error information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source": {
        "invalid": true
      },
      "error": "Conversion failed"
    }
    ```
  </CodeCol>
</ExampleGrid>

### ECS to UDM

<ExampleGrid>
  <CommentCol>
    ECS network event fields...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "@timestamp": "2024-01-15T10:30:00.000Z",
      "source": {
        "ip": "192.168.1.100",
        "port": 54321,
        "user": { "name": "jdoe" }
      },
      "destination": {
        "ip": "10.0.0.50",
        "port": 443
      },
      "event": {
        "action": "connection",
        "severity": "low"
      }
    }
    ```
    ```yaml
    - normalize:
        source_format: ecs
        target_format: udm
    ```
  </CodeCol>
  <CommentCol>
    are mapped to Google SecOps UDM fields:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "metadata": {
        "event_timestamp": 1705315800000000,
        "event_type": "NETWORK_CONNECTION"
      },
      "principal": {
        "ip": "192.168.1.100",
        "port": 54321,
        "user": { "userid": "jdoe" }
      },
      "target": {
        "ip": "10.0.0.50",
        "port": 443
      },
      "security_result": {
        "severity": "LOW",
        "action": "UNKNOWN_ACTION"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>
