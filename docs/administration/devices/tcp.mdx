# TCP

## Synopsis

```yaml
- id: <numeric>
  name: <string>
  description: <string>
  type: tcp
  tags: <string[]>
  pipelines: <pipeline[]>
  status: <boolean>
  properties:
    protocol: <string>
    address: <string>
    port: <numeric>
    framing: <string>
    line_delimiter: <string>
    max_connections: <numeric>
    timeout: <numeric>
    max_message_size: <numeric>
    reuse: <boolean>
    workers: <numeric>
    buffer_size: <numeric>
    batch_size: <numeric>
    queue:
      interval: <numeric>
    tls:
      status: <boolean>
      cert_name: <string>
      key_name: <string>
```

## Description

Creates a TCP server that accepts network messages over TCP connections. Supports both plain and TLS-encrypted connections, with configurable framing modes, connection management, and buffering options.

## Basic Configuration

The following are the minimum requirements to define the device.

### Device

|Field|Required|Default|Description|
|---|---|---|---|
|`id`|Y||Unique identifier|
|`name`|Y||Device name|
|`description`|N|-|Optional description|
|`type`|Y||Must be `tcp`|
|`status`|N|`true`|Enable/disable the device|

### Network

|Field|Required|Default|Description|
|---|---|---|---|
|`protocol`|N|`"tcp"`|Transport protocol (must be tcp)|
|`address`|N|`"0.0.0.0"`|Listen address|
|`port`|Y||Listen port|

### TCP

|Field|Required|Default|Description|
|---|---|---|---|
|`framing`|N|`"delimiter"`|Framing mode (`delimiter` or `octet`)|
|`line_delimiter`|N|`"\\n"`|Line separator for delimiter framing|
|`max_connections`|N|`10000`|Maximum concurrent connections|
|`timeout`|N|`300`|Connection timeout in seconds|
|`max_message_size`|N|`20971520`|Maximum message size in bytes (20MB)|

:::warning
When using delimiter framing, ensure the `line_delimiter` matches the client's to prevent message parsing errors.
:::

### TLS

|Field|Required|Default|Description|
|---|---|---|---|
|`tls.status`|N|`false`|Enable TLS encryption|
|`tls.cert_name`|Y||TLS certificate file path (required if TLS enabled)|
|`tls.key_name`|Y||TLS private key file path (required if TLS enabled)|

:::note
The TLS certificate and key files must be placed in the service root directory.
:::

## Advanced Configuration

To enhance performance and achieve better message handling, the following settings are used.

### Performance

|Field|Required|Default|Description|
|---|---|---|---|
|`reuse`|N|`true`|Enable socket address reuse|
|`workers`|N|`<dynamic>`|Number of worker processes when reuse is enabled|
|`buffer_size`|N|`1048576`|Network read buffer size in bytes (1MB)|

### Messages

|Field|Required|Default|Description|
|---|---|---|---|
|`batch_size`|N|`1000`|Number of messages to batch before processing|
|`queue.interval`|N|`1`|Queue processing interval in seconds|

## Examples

### Basic

The minimum required settings using the defaults are:

- `protocol`: "tcp"
- `address`: "0.0.0.0"
- Default framing and timeout settings

<ExampleGrid>
  <CommentCol>
    Create a simple TCP server...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 1
      name: basic_tcp
      type: tcp
      properties:
        port: 514
    ```
  </CodeCol>
</ExampleGrid>

### High Performance

Make sure that the following are used:

- Multiple worker processes
- A larger buffer size (4MB)
- Increased connection limit
- Optimized batch processing

<ExampleGrid>
  <CommentCol>
    Optimized for high message volumes...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 2
      name: performance_tcp
      type: tcp
      properties:
        port: 514
        reuse: true
        workers: 4
        buffer_size: 4194304
        max_connections: 20000
        batch_size: 5000
        queue:
          interval: 2
    ```
  </CodeCol>
</ExampleGrid>

:::note
The worker count cannot be less than 1, and will be automatically capped at the maximum number of physical cores available on the system.
:::

### Custom Framing

For a custom framing configuration, use:

- CRLF message delimiter
- 5MB message size limit
- 1-minute connection timeout

<ExampleGrid>
  <CommentCol>
    TCP server with custom message framing...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 3
      name: framed_tcp
      type: tcp
      properties:
        port: 1514
        framing: delimiter
        line_delimiter: "\r\n"
        max_message_size: 5242880
        timeout: 60
    ```
  </CodeCol>
</ExampleGrid>

### TLS Encrypted

For enhanced security, make sure that:

- TLS encryption is enabled
- A custom certificate and key are used
- Connection limits are set
- An extended timeout is set for the TLS handshake

<ExampleGrid>
  <CommentCol>
    Secure TCP server with TLS encryption...
  </CommentCol>
  <CodeCol>
    ```yaml
    - id: 4
      name: secure_tcp
      type: tcp
      properties:
        port: 6514
        tls:
          status: true
          cert_name: cert.pem
          key_name: key.pem
        max_connections: 5000
        timeout: 120
    ```
  </CodeCol>
</ExampleGrid>
