---
description: Enriches data with IP Quality Score
---

# IP Quality Score

<span class="theme-doc-version-badge badge badge--primary">Enrichment</span><span class="theme-doc-version-badge badge badge--secondary">Fraud Detection</span><span class="theme-doc-version-badge badge badge--secondary">Threat Intelligence</span>

## Synopsis

A multi-purpose enrichment processor that leverages IP Quality Score APIs to provide fraud detection, validation, and threat intelligence for IP addresses, email addresses, URLs/domains, and phone numbers.

## Schema

```yaml {2-6}
ipqs:
  - field: <ident>
  - api_key: <string>
  - query_type: <enum>
  - strictness: <number>
  - fast_mode: <boolean>
  - description: <text>
  - if: <script>
  - ignore_failure: <boolean>
  - ignore_missing: <boolean>
  - light_mode: <boolean>
  - user_agent: <string>
  - user_language: <string>
  - on_failure: <processor[]>
  - on_success: <processor[]>
  - tag: <string>
  - target_field: <ident>
```

## Configuration

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|Y|-|Field containing the value to analyze|
|`api_key`|Y|-|IPQS API key|
|`query_type`|N|`ip`|Type of query: `ip`, `email`, `url`, or `phone`|
|`strictness`|N|`0`|Fraud scoring strictness (0-3)|
|`fast_mode`|N|`false`|Enable faster response with less accuracy|
|`target_field`|N|`field`|Field to store the API response|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|Continue if API call fails|
|`ignore_missing`|N|`false`|Continue if source field doesn't exist|
|`light_mode`|N|`false`|Return limited data for faster response|
|`user_agent`|N|-|User agent for URL analysis|
|`user_language`|N|-|Language for URL analysis|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`tag`|N|-|Identifier|

## Details

The processor provides its service through multiple endpoints such as IP reputation and proxy/VPN detection, email validation and disposable email detection, URL/domain intelligence and malicious URL scanning, and phone number validation and fraud scoring.

:::note
Consider API rate limits in high-volume scenarios.
:::

Multiple validation services are used to gather intelligence. Phone and email validation checks multiple fraud indicators. 

User agent and language can help improve URL analysis accuracy.

Strictness level is configurable. Higher strictness levels provide more accurate fraud detection, while fast mode and light mode can reduce API response times. Similarly, higher strictness levels may increase false positives whereas fast mode may reduce detection accuracy.

Performance optimization is also available.

:::warning
Store API keys securely using environment variables.
:::

## Examples

### IPs

<ExampleGrid>
  <CommentCol>
    Checking IP reputation...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source_ip": "8.8.8.8"
    }
    ```
    ```yaml
    ipqs:
      - field: source_ip
      - query_type: ip
      - api_key: "${IPQS_API_KEY}"
      - strictness: 2
    ```
  </CodeCol>
  <CommentCol>
    returns detailed IP information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source_ip": "8.8.8.8",
      "proxy": false,
      "vpn": false,
      "fraud_score": 5,
      "country_code": "US",
      "city": "Mountain View",
      "ISP": "Google LLC"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Emails

<ExampleGrid>
  <CommentCol>
    Checking an email address...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "email": "test@example.com"
    }
    ```
    ```yaml
    ipqs:
      - field: email
      - query_type: email
      - api_key: "${IPQS_API_KEY}"
      - target_field: email_check
    ```
  </CodeCol>
  <CommentCol>
    validates its reputation:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "email": "test@example.com",
      "email_check": {
        "valid": true,
        "disposable": false,
        "deliverable": true,
        "fraud_score": 15,
        "recent_abuse": false,
        "suggested_domain": null
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### URLs

<ExampleGrid>
  <CommentCol>
    Analyzing URLs for malicious content...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "url": "http://example.com/download.exe"
    }
    ```
    ```yaml
    ipqs:
      - field: url
      - query_type: url
      - api_key: "${IPQS_API_KEY}"
      - user_agent: "Mozilla/5.0"
      - user_language: "en-US"
    ```
  </CodeCol>
  <CommentCol>
    provides security information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "url": "http://example.com/download.exe",
      "unsafe": true,
      "domain_age": "2 days",
      "malware": true,
      "parking": false,
      "spamming": false,
      "suspicious": true,
      "risk_score": 85
    }
    ```
  </CodeCol>
</ExampleGrid>

### Fast Mode

<ExampleGrid>
  <CommentCol>
    IP checks using reduced detail...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "ip": "1.1.1.1"
    }
    ```
    ```yaml
    ipqs:
      - field: ip
      - query_type: ip
      - api_key: "${IPQS_API_KEY}"
      - fast_mode: true
      - light_mode: true
    ```
  </CodeCol>
  <CommentCol>
    returns the essential data quickly:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "ip": "1.1.1.1",
      "proxy": false,
      "vpn": false,
      "fraud_score": 0,
      "country_code": "AU"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Phones

<ExampleGrid>
  <CommentCol>
    Validating phone number...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "phone": "+1234567890"
    }
    ```
    ```yaml
    ipqs:
      - field: phone
      - query_type: phone
      - api_key: "${IPQS_API_KEY}"
      - strictness: 1
    ```
  </CodeCol>
  <CommentCol>
    provides phone intelligence:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "phone": "+1234567890",
      "valid": true,
      "active": true,
      "formatted": "+1 (234) 567-890",
      "fraud_score": 25,
      "recent_abuse": false,
      "carrier": "Verizon",
      "line_type": "Mobile"
    }
    ```
  </CodeCol>
</ExampleGrid>
