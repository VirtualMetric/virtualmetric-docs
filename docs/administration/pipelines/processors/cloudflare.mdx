---
description: Retrieves intelligence from Cloudflare's API
---

# Cloudflare Intel

<span class="theme-doc-version-badge badge badge--primary">Enrichment</span><span class="theme-doc-version-badge badge badge--secondary">Threat Intelligence</span>

## Synopsis

Enriches events by retrieving intelligence information from **Cloudflare**'s API for domains, _IP_ addresses, _WHOIS_ records, and _Autonomous System Numbers_.

## Schema

```yaml {2-6}
cloudflare:
  - field: <ident>
  - api_token: <string>
  - account_id: <string>
  - query_type: <enum>
  - target_field: <ident>
  - description: <text>
  - if: <script>
  - ignore_failure: <boolean>
  - ignore_missing: <boolean>
  - on_failure: <processor[]>
  - on_success: <processor[]>
  - tag: <string>
```

## Configuration

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|N|`"domain"`|Field containing query value|
|`api_token`|Y|-|Cloudflare API token|
|`account_id`|Y|-|Cloudflare Account ID|
|`query_type`|N|`"whois"`|Intelligence query type. Options: `whois`, `ip`, `asn`, `domain`|
|`target_field`|N|`field`|Field to store API response|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|Continue if API call fails|
|`ignore_missing`|N|`false`|Continue if source field doesn't exist|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`tag`|N|-|Identifier|

## Details

The processor is useful for threat intelligence, network analysis, and contextual enrichment. It uses **Cloudflare**'s Intelligence API to retrieve detailed information about domains, IP addresses, WHOIS records, and _Autonomous System Numbers_ (ASNs) to provide detailed network information.

:::warning[caution]
Be aware of **Cloudflare** API rate limits.
:::

Bear in mind, however, that private or local IP addresses may have limited intelligence, and ASN lookup accuracy depends on **Cloudflare**'s database.

:::tip
API calls may add latency to event processing, so **Cloudflare** API keys are cached for performance. 
:::

Available query types:

<TermTable>
  <TermCol>`asn`</TermCol><DefCol>Retrieve _Autonomous System Number_ details</DefCol>
  <TermCol>`domain`</TermCol><DefCol>Retrieve domain-related intelligence</DefCol>
  <TermCol>`ip`</TermCol><DefCol>Get intelligence information for _IPv4_ and _IPv6_ addresses</DefCol>
  <TermCol>`whois`</TermCol><DefCol>Retrieve domain registration details</DefCol>
</TermTable>

Support for error handling, environment variables, and conditionals are also available.

:::warning
API tokens must be managed securely. Also, ensure proper account access and permissions.
:::

## Examples

### Basic

<ExampleGrid>
  <CommentCol>
    Retrieving WHOIS information...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "domain": "example.com"
    }
    ```
    ```yaml
    cloudflare:
      - field: domain
      - api_token: "${CLOUDFLARE_API_TOKEN}"
      - account_id: "${CLOUDFLARE_ACCOUNT_ID}"
      - query_type: whois
    ```
  </CodeCol>
  <CommentCol>
    adds domain registration details:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "domain": "example.com",
      "domain_whois": {
        "registrar": "Example Registrar",
        "creation_date": "2000-01-01",
        "expiration_date": "2025-01-01"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### IPs

<ExampleGrid>
  <CommentCol>
    Retrieving intelligence for an IP address...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source_ip": "1.1.1.1"
    }
    ```
    ```yaml
    cloudflare:
      - field: source_ip
      - target_field: ip_intel
      - api_token: "${CLOUDFLARE_API_TOKEN}"
      - account_id: "${CLOUDFLARE_ACCOUNT_ID}"
      - query_type: ip
    ```
  </CodeCol>
  <CommentCol>
    provides IP-related information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "source_ip": "1.1.1.1",
      "ip_intel": {
        "asn": "13335",
        "organization": "Cloudflare, Inc.",
        "country": "US",
        "network": "1.1.1.0/24"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### ASNs

<ExampleGrid>
  <CommentCol>
    Retrieving _Autonomous System Number_ details...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "asn": "13335"
    }
    ```
    ```yaml
    cloudflare:
      - field: asn
      - target_field: asn_intel
      - api_token: "${CLOUDFLARE_API_TOKEN}"
      - account_id: "${CLOUDFLARE_ACCOUNT_ID}"
      - query_type: asn
    ```
  </CodeCol>
  <CommentCol>
    provides network-related information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "asn": "13335",
      "asn_intel": {
        "organization": "Cloudflare, Inc.",
        "country": "US",
        "network_range": "1.1.1.0/24",
        "type": "Content Delivery Network"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### Conditionals

<ExampleGrid>
  <CommentCol>
    Performing lookup only for high-threat domains...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "domain": "suspicious-domain.com",
      "threat_level": "high"
    }
    ```
    ```yaml
    cloudflare:
      - field: domain
      - if: "ctx.threat_level == 'high'"
      - target_field: domain_threat_intel
      - api_token: "${CLOUDFLARE_API_TOKEN}"
      - account_id: "${CLOUDFLARE_ACCOUNT_ID}"
      - query_type: domain
    ```
  </CodeCol>
  <CommentCol>
    retrieves only the relevant information:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "domain": "suspicious-domain.com",
      "threat_level": "high",
      "domain_threat_intel": {
        "known_malicious": true,
        "category": "Phishing",
        "first_seen": "2023-01-15"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### Error Handling

<ExampleGrid>
  <CommentCol>
    Anticipating lookup failures...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "investigate_ip": "192.168.1.1"
    }
    ```
    ```yaml
    cloudflare:
      - field: investigate_ip
      - ignore_missing: true
      - ignore_failure: true
      - api_token: "${CLOUDFLARE_API_TOKEN}"
      - account_id: "${CLOUDFLARE_ACCOUNT_ID}"
      - on_failure:
          - set:
              field: lookup_status
              value: "intelligence_lookup_failed"
    ```
  </CodeCol>
  <CommentCol>
    deals with errors gracefully:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "investigate_ip": "192.168.1.1",
      "lookup_status": "intelligence_lookup_failed"
    }
    ```
  </CodeCol>
</ExampleGrid>
