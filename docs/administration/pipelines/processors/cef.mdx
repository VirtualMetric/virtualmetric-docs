---
description: Parses Common Event Format (CEF) messages
---

# CEF

## Synopsis

```yaml {2}
cef:
  - field: <ident>
  - target_field: <ident>
  - description: <text>
  - if: <script>
  - ignore_failure: <boolean>
  - ignore_missing: <boolean>
  - on_failure: <processor[]>
  - on_success: <processor[]>
  - tag: <string>
```

## Description

**Functionality**: Parses Common Event Format (CEF) messages into structured objects.

CEF is a standardized logging format commonly used by security devices and applications to communicate events.

The processor extracts both CEF header fields and extension fields. The header contains standardized fields like `vendor`, `product`, `version`, etc., while extensions contain key-value pairs with additional event details.

:::note
Type conversion is handled automatically for numeric values in extension fields, e.g. port numbers, counts, etc.
:::

## Parameters

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|Y|-|Field containing the CEF message to parse|
|`target_field`|N|`cef`|Field to store the parsed CEF object|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|Continue processing if parsing fails|
|`ignore_missing`|N|`false`|Skip processing if source field doesn't exist|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`tag`|N|-|Identifier|

:::warning
The message must begin with "`CEF:`" and contain all seven header fields separated by pipe (`|`) characters. Messages not following this format will cause parsing to fail.
:::

## CEF Header Fields

The processor extracts the following standard header fields:

|Field|Description|Example|
|---|---|---|
|`cefVersion`|CEF format version|`0`|
|`deviceVendor`|Who created the event|`Cisco`|
|`deviceProduct`|What generated the event|`ASA`|
|`deviceVersion`|Version of the product|`9.1`|
|`deviceEventClassId`|Event type identifier|`106100`|
|`name`|Human-readable description|`access-list`|
|`severity`|Integer indicating severity|`5`|

## Examples

### Basic Parsing

<ExampleGrid>
  <CommentCol>
    Parsing a basic CEF message...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "CEF:0|Security|threatmanager|1.0|100|worm successfully stopped|10|src=10.0.0.1 dst=2.1.2.2 spt=1232"
    }
    ```
    ```yaml
    cef:
      - field: message
    ```
  </CodeCol>
  <CommentCol>
    extracts the header and the extension fields:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "CEF:0|Security|threatmanager|1.0|100|worm successfully stopped|10|src=10.0.0.1 dst=2.1.2.2 spt=1232",
      "cef": {
        "cefVersion": 0,
        "deviceVendor": "Security",
        "deviceProduct": "threatmanager",
        "deviceVersion": "1.0",
        "deviceEventClassId": 100,
        "name": "worm successfully stopped",
        "severity": 10,
        "src": "10.0.0.1",
        "dst": "2.1.2.2",
        "spt": 1232
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### Security Devices

<ExampleGrid>
  <CommentCol>
    Parsing a Cisco ASA firewall log...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "CEF:0|Cisco|ASA|9.1|106100|access-list|5|src=192.168.1.100 dst=10.0.0.50 spt=52777 dpt=443 proto=TCP act=Permit app=HTTPS deviceDirection=0 rt=Mar 10 2024 12:30:45"
    }
    ```
    ```yaml
    cef:
      - field: message
      - target_field: firewall_event
    ```
  </CodeCol>
  <CommentCol>
    structures the firewall event data:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "CEF:0|Cisco|ASA|9.1|106100|access-list|5|src=192.168.1.100 dst=10.0.0.50 spt=52777 dpt=443 proto=TCP act=Permit app=HTTPS deviceDirection=0 rt=Mar 10 2024 12:30:45",
      "firewall_event": {
        "cefVersion": 0,
        "deviceVendor": "Cisco",
        "deviceProduct": "ASA",
        "deviceVersion": "9.1",
        "deviceEventClassId": 106100,
        "name": "access-list",
        "severity": 5,
        "src": "192.168.1.100",
        "dst": "10.0.0.50",
        "spt": 52777,
        "dpt": 443,
        "proto": "TCP",
        "act": "Permit",
        "app": "HTTPS",
        "deviceDirection": 0,
        "rt": "Mar 10 2024 12:30:45"
      }
    }
    ```
  </CodeCol>
</ExampleGrid>

### Error Handling

<ExampleGrid>
  <CommentCol>
    Handling invalid CEF messages...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "Invalid CEF message"
    }
    ```
    ```yaml
    cef:
      - field: message
      - ignore_failure: true
      - on_failure:
          - append:
              field: tags
              value: cef_parse_error
    ```
  </CodeCol>
  <CommentCol>
    adds an error tag when the parsing fails:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "Invalid CEF message",
      "tags": ["cef_parse_error"]
    }
    ```
  </CodeCol>
</ExampleGrid>
