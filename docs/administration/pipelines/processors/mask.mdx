---
description: Masks sensitive data using hashing functions
---

# Mask

<span class="theme-doc-version-badge badge badge--primary">Processor</span><span class="theme-doc-version-badge badge badge--secondary">Cribl Compatible</span>

## Synopsis

Provides data masking capabilities using various hashing functions. This processor is particularly useful for protecting sensitive data like PII (Personally Identifiable Information) by applying hash functions while optionally preserving portions of the original value.

## Schema

```yaml {2-6}
mask:
  - field: <ident>
  - masking_rules: <rule[]>
  - target_fields: <string[]>
  - depth: <numeric>
  - hash_type: <enum>
  - description: <text>
  - if: <script>
  - ignore_failure: <boolean>
  - ignore_missing: <boolean>
  - on_failure: <processor[]>
  - on_success: <processor[]>
  - tag: <string>
```

## Configuration

|Field|Required|Default|Description|
|---|---|---|---|
|`field`|Y|-|Field containing sensitive data to mask|
|`masking_rules`|Y|-|List of masking rules to apply|
|`target_fields`|N|`["message"]`|Fields to apply masking to|
|`depth`|N|`5`|Maximum depth to traverse nested fields|
|`hash_type`|N|`sha256`|Hash algorithm to use (md5, sha1, sha256, sha512)|
|`description`|N|-|Explanatory note|
|`if`|N|-|Condition to run|
|`ignore_failure`|N|`false`|Continue if masking fails|
|`ignore_missing`|N|`false`|Continue if source field doesn't exist|
|`on_failure`|N|-|See [Handling Failures](../handling-failures.mdx)|
|`on_success`|N|-|See [Handling Success](../handling-success.mdx)|
|`tag`|N|-|Identifier|

### Masking Rule Properties

|Field|Required|Default|Description|
|---|---|---|---|
|`match_regex`|Y|-|Pattern to match sensitive data|
|`hash_type`|N|`sha256`|Hash algorithm for this rule|
|`enabled`|N|`true`|Whether this rule is active|
|`keep_first`|N|`0`|Number of characters to preserve from start|
|`keep_last`|N|`0`|Number of characters to preserve from end|

## Details

The processor uses regular expressions to identify sensitive data and applies hash functions to mask it. It supports preserving portions of the original value and multiple hash algorithms for different security requirements.

### Key Features
- Multiple hash algorithms (MD5, SHA1, SHA256, SHA512)
- Partial value preservation
- Multiple field targeting
- Configurable masking rules
- Pattern-based matching
- Conditional execution

:::warning
MD5 is cryptographically broken and should not be used for security purposes. It is only included for Cribl compatibility. VirtualMetric highly recommends using at least SHA-256 for any sensitive data masking.
:::

## Examples

### Basic Social Security Number Masking

<ExampleGrid>
  <CommentCol>
    Mask social security numbers...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "social=123456789"
    }
    ```
    ```yaml
    mask:
      - target_fields: ["message"]
      - masking_rules:
          - match_regex: "(social=)(\\d+)"
            hash_type: "md5"
            keep_first: 7
    ```
  </CodeCol>
  <CommentCol>
    preserves "social=" and hashes numbers:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "social=a1b2c3d4e5f6g7h8i9"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Credit Card Number Masking

<ExampleGrid>
  <CommentCol>
    Mask credit card while preserving ends...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "cardNumber=4111-1111-1111-1111"
    }
    ```
    ```yaml
    mask:
      - target_fields: ["message"]
      - masking_rules:
          - match_regex: "\\b(\\d{4})[- ]?(\\d{4})[- ]?(\\d{4})[- ]?(\\d{4})\\b"
            hash_type: "sha256"
            keep_first: 4
            keep_last: 4
    ```
  </CodeCol>
  <CommentCol>
    keeps first/last 4 digits:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "cardNumber=4111********1111"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Multiple Field Masking

<ExampleGrid>
  <CommentCol>
    Apply masking to multiple fields...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "field1": "secret123",
      "field2": "secret456"
    }
    ```
    ```yaml
    mask:
      - target_fields: ["field1", "field2"]
      - masking_rules:
          - match_regex: "secret\\d+"
            hash_type: "md5"
    ```
  </CodeCol>
  <CommentCol>
    masks all matching fields:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "field1": "d4e5f6g7h8i9",
      "field2": "j0k1l2m3n4o5"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Conditional Masking

<ExampleGrid>
  <CommentCol>
    Only mask when condition is met...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "secret123",
      "level": "info"
    }
    ```
    ```yaml
    mask:
      - if: "ctx.level == 'secure'"
      - target_fields: ["message"]
      - masking_rules:
          - match_regex: "secret\\d+"
            hash_type: "md5"
    ```
  </CodeCol>
  <CommentCol>
    skips masking due to condition:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "secret123",
      "level": "info"
    }
    ```
  </CodeCol>
</ExampleGrid>

### Missing Field Handling

<ExampleGrid>
  <CommentCol>
    Handle missing fields gracefully...
  </CommentCol>
  <CodeCol>
    ```json
    {}
    ```
    ```yaml
    mask:
      - target_fields: ["nonexistent"]
      - masking_rules:
          - match_regex: "secret\\d+"
            hash_type: "md5"
      - ignore_missing: true
    ```
  </CodeCol>
  <CommentCol>
    continues processing:
  </CommentCol>
  <CodeCol>
    ```json
    {}
    ```
  </CodeCol>
</ExampleGrid>

### Different Hash Types

<ExampleGrid>
  <CommentCol>
    Use different hash algorithms...
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "secret123"
    }
    ```
    ```yaml
    mask:
      - target_fields: ["message"]
      - masking_rules:
          - match_regex: "secret\\d+"
            hash_type: "sha256"
    ```
  </CodeCol>
  <CommentCol>
    applies SHA256 hashing:
  </CommentCol>
  <CodeCol>
    ```json
    {
      "message": "e7cf3ef4f17c3999a94f2c6f612e8a888e5b1026878e4e19398b23bd38ec221a"
    }
    ```
  </CodeCol>
</ExampleGrid>

:::note
- If no rules match, the field remains unchanged
- Empty field content is treated as non-matching
- Hash type defaults to sha256 if not specified
:::

:::warning
- Complex regular expressions may impact performance
- Invalid regex patterns will cause errors unless ignore_failure is true
- Non-string field values will cause errors unless ignore_failure is true
- Missing fields will cause errors unless ignore_missing is true
:::